function existing_photos(){var a=jQuery;return a(".wsuwp-profile-photo-id").map(function(){return parseInt(a(this).val())}).get()}!function(a,b,c){a(c).ready(function(){var c,d=_.template(a(".wsuwp-profile-repeatable-field-template").html()),e=_.template(a("#photo-template").html()),f=a(".wsuwp-profile-photo-controls-tooltip"),g=a("#publishing-action .spinner"),h=a(".refresh-card .spinner"),i=a("#title"),j=a("#_wsuwp_profile_ad_nid"),k=a(".profile-card-data"),l=a("#confirm-ad-hash"),m=a(".wsuwp-profile-photo-collection"),n=a("#confirm-ad-data"),o=a("#refresh-ad-data"),p=a("#undo-ad-data-refresh");a("#wsuwp-profile-about-wrapper").tabs({active:0}),a(".wsuwp-profile-add-repeatable").on("click","a",function(b){b.preventDefault(),a(this).closest("p").before(d({label:a(this).data("label"),name:a(this).data("name"),value:""}))}),a(".wsuwp-profile-repeatable-field").on("click",".remove",function(){a(this).closest("p").remove()}),a("#load-ad-data, #refresh-ad-data").on("click",function(c){if(c.preventDefault(),c.target.disabled=!0,""===j.val())return void b.alert("Please enter a Network ID");a(c.target).is("#refresh-ad-data")?(h.css("visibility","visible"),k.each(function(){a(this).data("original",a(this).html())})):g.css("visibility","visible");var d={action:"wsu_people_get_data_by_nid",_ajax_nonce:b.wsupeople.nid_nonce,network_id:j.val(),request_from:b.wsupeople.request_from,is_refresh:a(c.target).is("#refresh-ad-data")?"true":"false"};a.post(b.ajaxurl,d,function(d){if(a(".spinner").css("visibility","hidden"),c.target.disabled=!1,!d.success)return void b.alert(d.data);d.data.id?populate_from_people_directory(d.data):(a("#_wsuwp_profile_ad_name_first").html(d.data.given_name),a("#_wsuwp_profile_ad_name_last").html(d.data.surname),a("#_wsuwp_profile_ad_title").html(d.data.title),a("#_wsuwp_profile_ad_office").html(d.data.office),a("#_wsuwp_profile_ad_address").html(d.data.street_address),a("#_wsuwp_profile_ad_phone").html(d.data.telephone_number),a("#_wsuwp_profile_ad_email").html(d.data.email),l.val(d.data.confirm_ad_hash)),n.removeClass("profile-hide-button"),p.removeClass("profile-hide-button"),o.addClass("profile-hide-button")})}),n.on("click",function(c){c.preventDefault(),c.target.disabled=!0,a(c.target).hasClass("refresh")?(h.css("visibility","visible"),p.addClass("profile-hide-button")):(g.css("visibility","visible"),a("#load-ad-data").addClass("profile-hide-button"));var d={action:"wsu_people_confirm_nid_data",_ajax_nonce:b.wsupeople.nid_nonce,network_id:j.val(),confirm_ad_hash:l.val(),post_id:a("#post_ID").val(),request_from:b.wsupeople.request_from},e=a(".load-ad-container .description"),f=a("#publish");a.post(b.ajaxurl,d,function(b){b.success&&(""===i.val()&&(i.focus(),i.val(a("#_wsuwp_profile_ad_name_first").html()+" "+a("#_wsuwp_profile_ad_name_last").html())),j.attr("readonly",!0),e.html("The WSU Network ID used to populate this profile's data from Active Directory."),a(".spinner").css("visibility","hidden"),n.addClass("profile-hide-button"),f.removeClass("profile-hide-button"))})}),p.on("click",function(b){b.preventDefault(),k.each(function(){a(this).html(a(this).data("original"))}),n.addClass("profile-hide-button"),p.addClass("profile-hide-button"),o.removeClass("profile-hide-button").disabled=!1}),a(".wsuwp-profile-add-photo").on("click",function(d){if(d.preventDefault(),c)return void c.open();c=b.wp.media({title:"Select or Upload Your Photos",multiple:!0,library:{type:"image",uploadedTo:b.wsupeople.post_id},button:{text:"Use photo(s)"}}),c.on("select",function(){var b=c.state().get("selection");a.each(b.models,function(b,c){var d=c.toJSON(),f=d.sizes.hasOwnProperty("thumbnail"),g=f?d.sizes.thumbnail.url:d.url,h=f?d.sizes.thumbnail.width:d.width,i=f?d.sizes.thumbnail.height:d.height;-1===a.inArray(d.id,existing_photos())&&m.append(e({src:g,width:h,height:i,id:d.id,alt:d.alt,url:d.url,title:d.title,full_width:d.width,full_height:d.height}))})}),c.open()}),m.on("mouseover",".wsuwp-profile-photo-controls button",function(){var a=this.getAttribute("aria-label"),b=this.getBoundingClientRect(),c=m[0].getBoundingClientRect();f.css({top:b.bottom-c.top+"px",left:b.right-c.left-f.width()/2-6+"px"}).show().find(".wsuwp-profile-photo-controls-tooltip-inner").html(a)}),m.on("mouseleave",".wsuwp-profile-photo-controls button",function(){f.hide()}),m.on("click",".wsuwp-profile-photo-remove",function(){f.hide(),a(this).closest(".wsuwp-profile-photo-wrapper").remove()}),m.on("click",".wsuwp-profile-photo-select",function(){var b=a(this),c=b.closest(".wsuwp-profile-photo-wrapper"),d=a(".use-photo");c.toggleClass("selected").siblings().removeClass("selected"),c.hasClass("selected")?(d.val(a(".wsuwp-profile-photo-wrapper").index(c)),b.attr("aria-label","Deselect"),c.siblings().removeClass("selected").find(".wsuwp-profile-photo-select").attr("aria-label","Select")):(d.val(""),b.attr("aria-label","Select"))})})}(jQuery,window,document);