function existing_photos(){var e=jQuery;return e(".wsuwp-profile-photo-id").map(function(){return parseInt(e(this).val())}).get()}var wsuwp=wsuwp||{};!function(e,t,i,a){e(i).ready(function(){var i,o=_.template(e(".wsuwp-profile-repeatable-field-template").html()),l=_.template(e("#photo-template").html()),s=e(".wsuwp-profile-photo-controls-tooltip"),r=e("#publishing-action .spinner"),p=e(".refresh-card .spinner"),n=e("#title"),d=e("#_wsuwp_profile_ad_nid"),u=e(".profile-card-data"),h=e("#confirm-ad-hash"),f=e(".wsuwp-profile-photo-collection"),c=e("#confirm-ad-data"),w=e("#refresh-ad-data"),m=e("#undo-ad-data-refresh");e("#wsuwp-profile-about-wrapper").tabs({active:0}),e(".wsuwp-profile-add-repeatable").on("click","a",function(t){t.preventDefault(),e(this).closest("p").before(o({label:e(this).data("label"),name:e(this).data("name"),value:""}))}),e(".wsuwp-profile-repeatable-field").on("click",".remove",function(){e(this).closest("p").remove()}),e("#load-ad-data, #refresh-ad-data").on("click",function(i){if(i.preventDefault(),i.target.disabled=!0,""!==d.val()){e(i.target).is("#refresh-ad-data")?(p.css("visibility","visible"),u.each(function(){e(this).data("original",e(this).html())})):r.css("visibility","visible");var o={action:"wsu_people_get_data_by_nid",_ajax_nonce:t.wsuwp_people_edit_profile.nid_nonce,network_id:d.val(),request_from:t.wsuwp_people_edit_profile.request_from,is_refresh:e(i.target).is("#refresh-ad-data")?"true":"false"};e.post(t.ajaxurl,o,function(o){e(".spinner").css("visibility","hidden"),i.target.disabled=!1,o.success?(o.data.id?a.people.populate_person_from_people_directory(o.data):(e("#_wsuwp_profile_ad_name_first").html(o.data.given_name),e("#_wsuwp_profile_ad_name_last").html(o.data.surname),e("#_wsuwp_profile_ad_title").html(o.data.title),e("#_wsuwp_profile_ad_office").html(o.data.office),e("#_wsuwp_profile_ad_address").html(o.data.street_address),e("#_wsuwp_profile_ad_phone").html(o.data.telephone_number),e("#_wsuwp_profile_ad_email").html(o.data.email),h.val(o.data.confirm_ad_hash)),c.removeClass("profile-hide-button"),m.removeClass("profile-hide-button"),w.addClass("profile-hide-button")):t.alert(o.data)})}else t.alert("Please enter a Network ID")}),c.on("click",function(i){i.preventDefault(),i.target.disabled=!0,e(i.target).hasClass("refresh")?(p.css("visibility","visible"),m.addClass("profile-hide-button")):(r.css("visibility","visible"),e("#load-ad-data").addClass("profile-hide-button"));var a={action:"wsu_people_confirm_nid_data",_ajax_nonce:t.wsuwp_people_edit_profile.nid_nonce,network_id:d.val(),confirm_ad_hash:h.val(),post_id:e("#post_ID").val(),request_from:t.wsuwp_people_edit_profile.request_from},o=e(".load-ad-container .description"),l=e("#publish");e.post(t.ajaxurl,a,function(t){t.success&&(""===n.val()&&(n.focus(),n.val(e("#_wsuwp_profile_ad_name_first").html()+" "+e("#_wsuwp_profile_ad_name_last").html())),d.attr("readonly",!0),o.html("The WSU Network ID used to populate this profile's data from Active Directory."),e(".spinner").css("visibility","hidden"),c.addClass("profile-hide-button"),l.removeClass("profile-hide-button"))})}),m.on("click",function(t){t.preventDefault(),u.each(function(){e(this).html(e(this).data("original"))}),c.addClass("profile-hide-button"),m.addClass("profile-hide-button"),w.removeClass("profile-hide-button").disabled=!1}),e(".wsuwp-profile-add-photo").on("click",function(a){a.preventDefault(),i?i.open():((i=t.wp.media({title:"Select or Upload Your Photos",multiple:!0,library:{type:"image",uploadedTo:t.wsuwp_people_edit_profile.post_id},button:{text:"Use photo(s)"}})).on("select",function(){var t=i.state().get("selection");e.each(t.models,function(t,i){var a=i.toJSON(),o=a.sizes.hasOwnProperty("thumbnail"),s=o?a.sizes.thumbnail.url:a.url,r=o?a.sizes.thumbnail.width:a.width,p=o?a.sizes.thumbnail.height:a.height;-1===e.inArray(a.id,existing_photos())&&f.append(l({src:s,width:r,height:p,id:a.id,alt:a.alt,url:a.url,title:a.title,full_width:a.width,full_height:a.height}))})}),i.open())}),f.on("mouseover",".wsuwp-profile-photo-controls button",function(){var e=this.getAttribute("aria-label"),t=this.getBoundingClientRect(),i=f[0].getBoundingClientRect();s.css({top:t.bottom-i.top+"px",left:t.right-i.left-s.width()/2-6+"px"}).show().find(".wsuwp-profile-photo-controls-tooltip-inner").html(e)}),f.on("mouseleave",".wsuwp-profile-photo-controls button",function(){s.hide()}),f.on("click",".wsuwp-profile-photo-remove",function(){s.hide(),e(this).closest(".wsuwp-profile-photo-wrapper").remove()}),f.on("click",".wsuwp-profile-photo-select",function(){var t=e(this),i=t.closest(".wsuwp-profile-photo-wrapper"),a=e(".use-photo");i.toggleClass("selected").siblings().removeClass("selected"),i.hasClass("selected")?(a.val(e(".wsuwp-profile-photo-wrapper").index(i)),t.attr("aria-label","Deselect"),i.siblings().removeClass("selected").find(".wsuwp-profile-photo-select").attr("aria-label","Select")):(a.val(""),t.attr("aria-label","Select"))})})}(jQuery,window,document,wsuwp);