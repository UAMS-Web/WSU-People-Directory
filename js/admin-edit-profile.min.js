function existing_photos(){var a=jQuery;return a(".wsuwp-profile-photo-id").map(function(){return parseInt(a(this).val())}).get()}var wsuwp=wsuwp||{};!function(a,b,c,d){a(c).ready(function(){var c,e=_.template(a(".wsuwp-profile-repeatable-field-template").html()),f=_.template(a("#photo-template").html()),g=a(".wsuwp-profile-photo-controls-tooltip"),h=a("#publishing-action .spinner"),i=a(".refresh-card .spinner"),j=a("#title"),k=a("#_wsuwp_profile_ad_nid"),l=a(".profile-card-data"),m=a("#confirm-ad-hash"),n=a(".wsuwp-profile-photo-collection"),o=a("#confirm-ad-data"),p=a("#refresh-ad-data"),q=a("#undo-ad-data-refresh");a("#wsuwp-profile-about-wrapper").tabs({active:0}),a(".wsuwp-profile-add-repeatable").on("click","a",function(b){b.preventDefault(),a(this).closest("p").before(e({label:a(this).data("label"),name:a(this).data("name"),value:""}))}),a(".wsuwp-profile-repeatable-field").on("click",".remove",function(){a(this).closest("p").remove()}),a("#load-ad-data, #refresh-ad-data").on("click",function(c){if(c.preventDefault(),c.target.disabled=!0,""===k.val())return void b.alert("Please enter a Network ID");a(c.target).is("#refresh-ad-data")?(i.css("visibility","visible"),l.each(function(){a(this).data("original",a(this).html())})):h.css("visibility","visible");var e={action:"wsu_people_get_data_by_nid",_ajax_nonce:b.wsuwp_people_edit_profile.nid_nonce,network_id:k.val(),request_from:b.wsuwp_people_edit_profile.request_from,is_refresh:a(c.target).is("#refresh-ad-data")?"true":"false"};a.post(b.ajaxurl,e,function(e){if(a(".spinner").css("visibility","hidden"),c.target.disabled=!1,!e.success)return void b.alert(e.data);e.data.id?d.people.populate_person_from_people_directory(e.data):(a("#_wsuwp_profile_ad_name_first").html(e.data.given_name),a("#_wsuwp_profile_ad_name_last").html(e.data.surname),a("#_wsuwp_profile_ad_title").html(e.data.title),a("#_wsuwp_profile_ad_office").html(e.data.office),a("#_wsuwp_profile_ad_address").html(e.data.street_address),a("#_wsuwp_profile_ad_phone").html(e.data.telephone_number),a("#_wsuwp_profile_ad_email").html(e.data.email),m.val(e.data.confirm_ad_hash)),o.removeClass("profile-hide-button"),q.removeClass("profile-hide-button"),p.addClass("profile-hide-button")})}),o.on("click",function(c){c.preventDefault(),c.target.disabled=!0,a(c.target).hasClass("refresh")?(i.css("visibility","visible"),q.addClass("profile-hide-button")):(h.css("visibility","visible"),a("#load-ad-data").addClass("profile-hide-button"));var d={action:"wsu_people_confirm_nid_data",_ajax_nonce:b.wsuwp_people_edit_profile.nid_nonce,network_id:k.val(),confirm_ad_hash:m.val(),post_id:a("#post_ID").val(),request_from:b.wsuwp_people_edit_profile.request_from},e=a(".load-ad-container .description"),f=a("#publish");a.post(b.ajaxurl,d,function(b){b.success&&(""===j.val()&&(j.focus(),j.val(a("#_wsuwp_profile_ad_name_first").html()+" "+a("#_wsuwp_profile_ad_name_last").html())),k.attr("readonly",!0),e.html("The WSU Network ID used to populate this profile's data from Active Directory."),a(".spinner").css("visibility","hidden"),o.addClass("profile-hide-button"),f.removeClass("profile-hide-button"))})}),q.on("click",function(b){b.preventDefault(),l.each(function(){a(this).html(a(this).data("original"))}),o.addClass("profile-hide-button"),q.addClass("profile-hide-button"),p.removeClass("profile-hide-button").disabled=!1}),a(".wsuwp-profile-add-photo").on("click",function(d){if(d.preventDefault(),c)return void c.open();c=b.wp.media({title:"Select or Upload Your Photos",multiple:!0,library:{type:"image",uploadedTo:b.wsuwp_people_edit_profile.post_id},button:{text:"Use photo(s)"}}),c.on("select",function(){var b=c.state().get("selection");a.each(b.models,function(b,c){var d=c.toJSON(),e=d.sizes.hasOwnProperty("thumbnail"),g=e?d.sizes.thumbnail.url:d.url,h=e?d.sizes.thumbnail.width:d.width,i=e?d.sizes.thumbnail.height:d.height;-1===a.inArray(d.id,existing_photos())&&n.append(f({src:g,width:h,height:i,id:d.id,alt:d.alt,url:d.url,title:d.title,full_width:d.width,full_height:d.height}))})}),c.open()}),n.on("mouseover",".wsuwp-profile-photo-controls button",function(){var a=this.getAttribute("aria-label"),b=this.getBoundingClientRect(),c=n[0].getBoundingClientRect();g.css({top:b.bottom-c.top+"px",left:b.right-c.left-g.width()/2-6+"px"}).show().find(".wsuwp-profile-photo-controls-tooltip-inner").html(a)}),n.on("mouseleave",".wsuwp-profile-photo-controls button",function(){g.hide()}),n.on("click",".wsuwp-profile-photo-remove",function(){g.hide(),a(this).closest(".wsuwp-profile-photo-wrapper").remove()}),n.on("click",".wsuwp-profile-photo-select",function(){var b=a(this),c=b.closest(".wsuwp-profile-photo-wrapper"),d=a(".use-photo");c.toggleClass("selected").siblings().removeClass("selected"),c.hasClass("selected")?(d.val(a(".wsuwp-profile-photo-wrapper").index(c)),b.attr("aria-label","Deselect"),c.siblings().removeClass("selected").find(".wsuwp-profile-photo-select").attr("aria-label","Select")):(d.val(""),b.attr("aria-label","Select"))})})}(jQuery,window,document,wsuwp);