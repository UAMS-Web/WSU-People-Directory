var wsuwp=wsuwp||{};!function(e,t,a,s){e(a).ready(function(){var a=e("#load-ad-data"),o=e("#publishing-action .spinner"),n=e("#_wsuwp_profile_ad_nid"),r=e("#confirm-ad-hash"),i=e("#confirm-ad-data"),d=e(".wsu-person .card"),l=_.template(e(".wsu-person-repeatable-meta-template").html());e(".card header").append("<button type='button' data-type='degree' class='wsu-person-add-repeatable-meta wsu-person-add-degree'>+ Add</button>"),e(".contact .title").last().after("\n<button type='button' data-type='title' class='wsu-person-add-repeatable-meta wsu-person-add-title'>+ Add another title</button>"),e.each(e(".contact .title").slice(1),function(){e(this).after("<button type='button' class='wsu-person-remove dashicons dashicons-no'><span class='screen-reader-text'>Delete</span></button>")}),e.each(e("header .degree"),function(){e(this).after("<button type='button' class='wsu-person-remove dashicons dashicons-no'><span class='screen-reader-text'>Delete</span></button>")}),a.on("click",function(a){if(a.preventDefault(),a.target.disabled=!0,""!==n.val()){o.css("visibility","visible");var d={action:"wsu_people_get_data_by_nid",_ajax_nonce:t.wsuwp_people_edit_profile.nid_nonce,network_id:n.val(),request_from:t.wsuwp_people_edit_profile.request_from,is_refresh:e(a.target).is("#refresh-ad-data")?"true":"false"};e.post(t.ajaxurl,d,function(d){a.target.disabled=!1,o.css("visibility","hidden"),d.success?(d.data.id?s.people.populate_person_from_people_directory(d.data):(e(".wsu-person").attr("data-nid",n.val()),e(".wsu-person .name").text(d.data.given_name+" "+d.data.surname),e("[name='post_title']").val(d.data.given_name+" "+d.data.surname),e(".wsu-person .title").text(d.data.title),e("[name='_wsuwp_profile_title[]']").val(d.data.title),e(".wsu-person .email").text(d.data.email),e("[name='_wsuwp_profile_alt_email']").val(d.data.email),e(".wsu-person .phone").text(d.data.telephone_number),e("[name='_wsuwp_profile_alt_phone']").val(d.data.telephone_number),e(".wsu-person .office").text(d.data.office),e("[name='_wsuwp_profile_alt_office']").val(d.data.office),e(".wsu-person .address").text(d.data.street_address),e("[name='_wsuwp_profile_alt_address']").val(d.data.street_address),r.val(d.data.confirm_ad_hash)),i.removeClass("profile-hide-button")):t.alert(d.data)})}else t.alert("Please enter a Network ID")}),i.on("click",function(a){a.preventDefault(),a.target.disabled=!0,o.css("visibility","visible"),e("#load-ad-data").addClass("profile-hide-button");var s={action:"wsu_people_confirm_nid_data",_ajax_nonce:t.wsuwp_people_edit_profile.nid_nonce,network_id:n.val(),confirm_ad_hash:r.val(),post_id:e("#post_ID").val(),request_from:t.wsuwp_people_edit_profile.request_from},d=e(".load-ad-container .description"),l=e("#publish");e.post(t.ajaxurl,s,function(t){t.success&&(n.attr("readonly",!0),d.html("The WSU Network ID used to populate this profile's data from "+d.data("location")+"."),e(".spinner").css("visibility","hidden"),i.addClass("profile-hide-button"),l.removeClass("profile-hide-button"))})}),d.on("focusout","[contenteditable='true']",function(){var t=e(this).attr("class"),a=e(this).index("."+t),s=e(this).text();e("[data-for='"+t+"']").eq(a).val(s)}),d.on("keypress","[contenteditable='true']",function(e){13===e.which&&e.preventDefault()}),d.on("click",".wsu-person-add-repeatable-meta",function(){e(this).before(l({type:e(this).data("type"),value:""}))}),d.on("focus",".title, .degree",function(){e(this).next("button:not(.wsu-person-add-repeatable-meta)").show(50)}),d.on("focusout",".title, .degree, .wsu-person-remove",function(t){var a=e(t.relatedTarget);if(a.hasClass("wsu-person-remove"))e(".wsu-person-remove:not(:focus)").hide(50);else if(a.hasClass("title")||a.hasClass("title")){var s=a.next(".wsu-person-remove").index(".wsu-person-remove");e(".wsu-person-remove").not(":eq("+s+")").hide(50)}else e(".wsu-person-remove").hide(50)}),d.on("click",".wsu-person-remove",function(){var t=e(this).prev("span"),a=t.attr("class"),s=t.index("."+a);t.remove(),e("[data-for='"+a+"']").eq(s).remove(),e(this).remove()})}),e(".taxonomy-select2").select2({placeholder:"+ Add",closeOnSelect:!1})}(jQuery,window,document,wsuwp);