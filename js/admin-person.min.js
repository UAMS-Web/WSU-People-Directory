!function(a,b,c){a(c).ready(function(){function c(){var b=a(".wsuwp-profile-photo-id").map(function(){return parseInt(a(this).val())}).get();return b}function d(c){var d=a(".wsuwp-profile-titles .wsuwp-profile-add-repeatable"),g=d.find("a").data("label"),h=d.find("a").data("name"),i=a(".wsuwp-profile-degrees .wsuwp-profile-add-repeatable"),k=i.find("a").data("label"),l=i.find("a").data("name");j.focus().val(c.title.rendered),m.html(c.first_name),n.html(c.last_name),o.html(c.position_title),p.html(c.office),q.html(c.address),r.html(c.phone),s.html(c.email),a("#_wsuwp_profile_alt_office").val(c.office_alt),a("#_wsuwp_profile_alt_phone").val(c.phone_alt),a("#_wsuwp_profile_alt_email").val(c.email_alt),a("#_wsuwp_profile_website").val(c.website),b.tinymce.get("content").setContent(c.content.rendered),b.tinymce.get("_wsuwp_profile_bio_unit").setContent(c.bio_unit),b.tinymce.get("_wsuwp_profile_bio_university").setContent(c.bio_university),a.each(c.working_titles,function(b,c){a("[name='_wsuwp_profile_title[]']")[b]?a(a("[name='_wsuwp_profile_title[]']")[b]).val(c):d.before(f({label:g,name:h,value:c}))}),a.each(c.degree,function(b,c){a("[name='_wsuwp_profile_degree[]']")[b]?a(a("[name='_wsuwp_profile_degree[]']")[b]).val(c):i.before(f({label:k,name:l,value:c}))}),0!==c._embedded["wp:photos"]&&a.each(c._embedded["wp:photos"],function(a,b){e(b)}),c._embedded["wp:featuredmedia"]&&0!==c._embedded["wp:featuredmedia"]&&e(c._embedded["wp:featuredmedia"][0])}function e(b){var d=b.media_details,e=d.sizes.thumbnail,f=e?d.sizes.thumbnail.source_url:b.source_url,h=e?d.sizes.thumbnail.width:d.width,i=e?d.sizes.thumbnail.height:d.height;-1===a.inArray(b.id,c())&&B.append(g({src:f,width:h,height:i,id:b.id,alt:b.alt,url:b.source_url,title:b.title.rendered,full_width:d.width,full_height:d.height}))}var f=_.template(a(".wsuwp-profile-repeatable-field-template").html()),g=_.template(a("#photo-template").html()),h=a("#publishing-action .spinner"),i=a(".refresh-card .spinner"),j=a("#title"),k=a("#_wsuwp_profile_ad_nid"),l=a(".profile-card-data"),m=a("#_wsuwp_profile_ad_name_first"),n=a("#_wsuwp_profile_ad_name_last"),o=a("#_wsuwp_profile_ad_title"),p=a("#_wsuwp_profile_ad_office"),q=a("#_wsuwp_profile_ad_address"),r=a("#_wsuwp_profile_ad_phone"),s=a("#_wsuwp_profile_ad_email"),t=a("#confirm-ad-hash"),u=a("#load-ad-data"),v=a("#confirm-ad-data"),w=a("#refresh-ad-data"),x=a("#undo-ad-data-refresh");a("#wsuwp-profile-tabs").tabs({active:0}),a(".wsuwp-profile-add-repeatable").on("click","a",function(b){b.preventDefault(),a(this).closest("p").before(f({label:a(this).data("label"),name:a(this).data("name"),value:""}))}),a(".wsuwp-profile-repeatable-field").on("click",".wsuwp-profile-remove-repeatable-field",function(b){b.preventDefault(),a(this).closest("p").remove()}),a("#load-ad-data, #refresh-ad-data").on("click",function(c){if(c.preventDefault(),c.target.disabled=!0,""===k.val())return void b.alert("Please enter a Network ID");a(c.target).is("#refresh-ad-data")?(i.css("visibility","visible"),l.each(function(){a(this).data("original",a(this).html())})):h.css("visibility","visible");var e={action:"wsu_people_get_data_by_nid",_ajax_nonce:b.wsupeople.nid_nonce,network_id:k.val(),source:b.wsupeople.request_from,is_refresh:a(c.target).is("#refresh-ad-data")?"true":"false"};a.post(b.ajaxurl,e,function(e){return a(".spinner").css("visibility","hidden"),c.target.disabled=!1,e.success?(e.data.id?d(e.data):(m.html(e.data.given_name),n.html(e.data.surname),o.html(e.data.title),p.html(e.data.office),q.html(e.data.street_address),r.html(e.data.telephone_number),s.html(e.data.email),t.val(e.data.confirm_ad_hash)),v.removeClass("profile-hide-button"),x.removeClass("profile-hide-button"),void w.addClass("profile-hide-button")):void b.alert(e.data)})}),v.on("click",function(c){c.preventDefault(),c.target.disabled=!0,a(c.target).hasClass("refresh")?(i.css("visibility","visible"),x.addClass("profile-hide-button")):(h.css("visibility","visible"),u.addClass("profile-hide-button"));var d={action:"wsu_people_confirm_nid_data",_ajax_nonce:b.wsupeople.nid_nonce,network_id:k.val(),confirm_ad_hash:t.val(),post_id:a("#post_ID").val(),source:b.wsupeople.request_from},e=a(".load-ad-container .description"),f=a("#publish");a("#post_name").val(a("#_wsuwp_profile_ad_name_first").html().toLowerCase()+"-"+a("#_wsuwp_profile_ad_name_last").html().toLowerCase()),a.post(b.ajaxurl,d,function(b){b.success&&(""===j.val()&&(j.focus(),j.val(a("#_wsuwp_profile_ad_name_first").html()+" "+a("#_wsuwp_profile_ad_name_last").html())),k.attr("readonly",!0),e.html("The WSU Network ID used to populate this profile's data from Active Directory."),a(".spinner").css("visibility","hidden"),v.addClass("profile-hide-button"),f.removeClass("profile-hide-button"))})}),x.on("click",function(b){b.preventDefault(),l.each(function(){a(this).html(a(this).data("original"))}),v.addClass("profile-hide-button"),x.addClass("profile-hide-button"),w.removeClass("profile-hide-button").disabled=!1});var y,z,A=a(".wsuwp-profile-add-photo"),B=a(".wsuwp-profile-photo-collection"),C=a(".wsuwp-profile-photo-controls-tooltip");A.on("click",function(d){return d.preventDefault(),y?void y.open():(y=b.wp.media({title:"Select or Upload Your Photos",multiple:!0,library:{type:"image",uploadedTo:b.wsupeople.post_id},button:{text:"Use photo(s)"}}),y.on("select",function(){var b=y.state().get("selection");a.each(b.models,function(b,d){var e=d.toJSON(),f=e.sizes.hasOwnProperty("thumbnail"),h=f?e.sizes.thumbnail.url:e.url,i=f?e.sizes.thumbnail.width:e.width,j=f?e.sizes.thumbnail.height:e.height;-1===a.inArray(e.id,c())&&B.append(g({src:h,width:i,height:j,id:e.id,alt:e.alt,url:e.url,title:e.title,full_width:e.width,full_height:e.height}))})}),void y.open())}),a("html").click(function(b){a(b.target).hasClass("wsuwp-profile-photo")?(a(b.target).next(".wsuwp-profile-photo-controls").show(),a(b.target).closest(".wsuwp-profile-photo-wrapper").siblings(".wsuwp-profile-photo-wrapper").find(".wsuwp-profile-photo-controls").hide()):a(".wsuwp-profile-photo-controls").hide()}),B.on("mouseover",".wsuwp-profile-photo-controls button",function(){var a=this.getAttribute("aria-label"),b=this.getBoundingClientRect(),c=B[0].getBoundingClientRect();C.find(".wsuwp-profile-photo-controls-tooltip-inner").html(a),C.css({top:b.bottom-c.top+"px",left:b.right-c.left-C.width()/2-6+"px"}).show()}),B.on("mouseleave",".wsuwp-profile-photo-controls button",function(){C.hide()}),B.on("click",".wsuwp-profile-photo-edit",function(c){c.preventDefault(),C.hide();var d=a(this).closest(".wsuwp-profile-photo-wrapper").find("img"),e={attachment_id:d.data("id"),size:"full",caption:"",align:"none",extraClasses:"",link:!1,title:d.attr("title"),url:d.data("url"),alt:d.attr("alt"),width:d.data("width"),height:d.data("height")};return z?void z.open():(b.wp.media.events.trigger("editor:image-edit",{metadata:e,image:d}),z=b.wp.media({frame:"image",state:"image-details",metadata:e}),z.on("close",function(){var a=z.state().image.attributes;d.attr("title",a.title),d.attr("alt",a.alt),d.data("width",a.width),d.data("height",a.height)}),void z.open())}),B.on("click",".wsuwp-profile-photo-remove",function(b){b.preventDefault(),C.hide(),a(this).closest(".wsuwp-profile-photo-wrapper").remove()})})}(jQuery,window,document);