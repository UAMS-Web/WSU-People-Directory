!function(a,b,c){a(c).ready(function(){function c(c){var f=a(".wsuwp-profile-titles .wsuwp-profile-add-repeatable"),g=f.find("a").data("label"),h=f.find("a").data("name"),j=a(".wsuwp-profile-degrees .wsuwp-profile-add-repeatable"),k=j.find("a").data("label"),s=j.find("a").data("name");i.focus().val(c.title.rendered),l.html(c.first_name),m.html(c.last_name),n.html(c.position_title),o.html(c.office),p.html(c.address),q.html(c.phone),r.html(c.email),a("#_wsuwp_profile_alt_office").val(c.office_alt),a("#_wsuwp_profile_alt_phone").val(c.phone_alt),a("#_wsuwp_profile_alt_email").val(c.email_alt),a("#_wsuwp_profile_website").val(c.website),b.tinymce.get("content").setContent(c.content.rendered),b.tinymce.get("_wsuwp_profile_bio_unit").setContent(c.bio_unit),b.tinymce.get("_wsuwp_profile_bio_university").setContent(c.bio_university),a("[name='_wsuwp_profile_title[]']").val(c.working_titles[0]),a.each(c.working_titles,function(a,b){a>0&&f.before(e({label:g,name:h,value:b}))}),a("[name='_wsuwp_profile_degree[]']").val(c.degree[0]),a.each(c.degree,function(a,b){a>0&&j.before(e({label:k,name:s,value:b}))}),0!==c._embedded["wp:photos"]&&a.each(c._embedded["wp:photos"],function(a,b){d(b)}),c._embedded["wp:featuredmedia"]&&0!==c._embedded["wp:featuredmedia"]&&d(c._embedded["wp:featuredmedia"][0])}function d(a){var b=a.media_details,c=b.sizes.thumbnail,d=c?b.sizes.thumbnail.source_url:a.source_url,e=c?b.sizes.thumbnail.width:b.width,g=c?b.sizes.thumbnail.height:b.height;A.append(f({src:d,width:e,height:g,id:a.id,alt:a.alt,url:a.source_url,title:a.title.rendered,full_width:b.width,full_height:b.height}))}var e=_.template(a(".wsuwp-profile-repeatable-field-template").html()),f=_.template(a("#photo-template").html()),g=a("#publishing-action .spinner"),h=a(".refresh-card .spinner"),i=a("#title"),j=a("#_wsuwp_profile_ad_nid"),k=a(".profile-card-data"),l=a("#_wsuwp_profile_ad_name_first"),m=a("#_wsuwp_profile_ad_name_last"),n=a("#_wsuwp_profile_ad_title"),o=a("#_wsuwp_profile_ad_office"),p=a("#_wsuwp_profile_ad_address"),q=a("#_wsuwp_profile_ad_phone"),r=a("#_wsuwp_profile_ad_email"),s=a("#confirm-ad-hash"),t=a("#load-ad-data"),u=a("#confirm-ad-data"),v=a("#refresh-ad-data"),w=a("#undo-ad-data-refresh");a("#wsuwp-profile-tabs").tabs({active:0}),a(".wsuwp-profile-add-repeatable").on("click","a",function(b){b.preventDefault(),a(this).closest("p").before(e({label:a(this).data("label"),name:a(this).data("name"),value:""}))}),a(".wsuwp-profile-repeatable-field").on("click",".wsuwp-profile-remove-repeatable-field",function(b){b.preventDefault(),a(this).closest("p").remove()}),a("#load-ad-data, #refresh-ad-data").on("click",function(d){if(""===j.val())return void b.alert("Please enter a Network ID");a(d.target).is("#refresh-ad-data")?(h.css("visibility","visible"),k.each(function(){a(this).data("original",a(this).html())})):g.css("visibility","visible");var e={action:"wsu_people_get_data_by_nid",_ajax_nonce:b.wsupeople.nid_nonce,network_id:j.val(),source:a(d.target).is("#refresh-ad-data")?"refresh":b.wsupeople.request_from};a.post(b.ajaxurl,e,function(d){return a(".spinner").css("visibility","hidden"),d.success?(d.data.id?c(d.data):(l.html(d.data.given_name),m.html(d.data.surname),n.html(d.data.title),o.html(d.data.office),p.html(d.data.street_address),q.html(d.data.telephone_number),r.html(d.data.email),s.val(d.data.confirm_ad_hash)),u.removeClass("profile-hide-button"),w.removeClass("profile-hide-button"),void v.addClass("profile-hide-button")):void b.alert(d.data)})}),u.on("click",function(c){a(c.target).hasClass("refresh")?h.css("visibility","visible"):g.css("visibility","visible");var d={action:"wsu_people_confirm_nid_data",_ajax_nonce:b.wsupeople.nid_nonce,network_id:j.val(),confirm_ad_hash:s.val(),post_id:a("#post_ID").val(),source:b.wsupeople.request_from},e=a(".load-ad-container .description"),f=a("#publish");a("#post_name").val(a("#_wsuwp_profile_ad_name_first").html().toLowerCase()+"-"+a("#_wsuwp_profile_ad_name_last").html().toLowerCase()),a.post(b.ajaxurl,d,function(b){b.success&&(""===i.val()&&(i.focus(),i.val(a("#_wsuwp_profile_ad_name_first").html()+" "+a("#_wsuwp_profile_ad_name_last").html())),j.attr("readonly",!0),e.html("The WSU Network ID used to populate this profile's data from Active Directory."),a(".spinner").css("visibility","hidden"),t.addClass("profile-hide-button"),u.addClass("profile-hide-button"),f.removeClass("profile-hide-button"),w.addClass("profile-hide-button"))})}),w.on("click",function(){k.each(function(){a(this).html(a(this).data("original"))}),u.addClass("profile-hide-button"),w.addClass("profile-hide-button"),v.removeClass("profile-hide-button")});var x,y,z=a(".wsuwp-profile-add-photo"),A=a(".wsuwp-profile-photo-collection"),B=a(".wsuwp-profile-photo-controls-tooltip");z.on("click",function(c){return c.preventDefault(),x?void x.open():(x=b.wp.media({title:"Select or Upload Your Photos",multiple:!0,library:{type:"image",uploadedTo:b.wsupeople.post_id},button:{text:"Use photo(s)"}}),x.on("select",function(){var b=x.state().get("selection"),c=[];a(".wsuwp-profile-photo-id").each(function(){c.push(parseInt(a(this).val()))}),a.each(b.models,function(b,d){var e=d.toJSON(),g=e.sizes.hasOwnProperty("thumbnail"),h=g?e.sizes.thumbnail.url:e.url,i=g?e.sizes.thumbnail.width:e.width,j=g?e.sizes.thumbnail.height:e.height;-1===a.inArray(e.id,c)&&A.append(f({src:h,width:i,height:j,id:e.id,alt:e.alt,url:e.url,title:e.title,full_width:e.width,full_height:e.height}))})}),void x.open())}),a("html").click(function(b){a(b.target).hasClass("wsuwp-profile-photo")?(a(b.target).next(".wsuwp-profile-photo-controls").show(),a(b.target).closest(".wsuwp-profile-photo-wrapper").siblings(".wsuwp-profile-photo-wrapper").find(".wsuwp-profile-photo-controls").hide()):a(".wsuwp-profile-photo-controls").hide()}),A.on("mouseover",".wsuwp-profile-photo-controls button",function(){var a=this.getAttribute("aria-label"),b=this.getBoundingClientRect(),c=A[0].getBoundingClientRect();B.find(".wsuwp-profile-photo-controls-tooltip-inner").html(a),B.css({top:b.bottom-c.top+"px",left:b.right-c.left-B.width()/2-6+"px"}).show()}),A.on("mouseleave",".wsuwp-profile-photo-controls button",function(){B.hide()}),A.on("click",".wsuwp-profile-photo-edit",function(c){c.preventDefault(),B.hide();var d=a(this).closest(".wsuwp-profile-photo-wrapper").find("img"),e={attachment_id:d.data("id"),size:"full",caption:"",align:"none",extraClasses:"",link:!1,title:d.attr("title"),url:d.data("url"),alt:d.attr("alt"),width:d.data("width"),height:d.data("height")};return y?void y.open():(b.wp.media.events.trigger("editor:image-edit",{metadata:e,image:d}),y=b.wp.media({frame:"image",state:"image-details",metadata:e}),y.on("close",function(){var a=y.state().image.attributes;d.attr("title",a.title),d.attr("alt",a.alt),d.data("width",a.width),d.data("height",a.height)}),void y.open())}),A.on("click",".wsuwp-profile-photo-remove",function(b){b.preventDefault(),B.hide(),a(this).closest(".wsuwp-profile-photo-wrapper").remove()})})}(jQuery,window,document);