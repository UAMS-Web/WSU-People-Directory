!function(a,b,c){a(c).ready(function(){function c(c){var f=a(".wsuwp-profile-titles .wsuwp-profile-add-repeatable"),h=f.find("a").data("label"),i=f.find("a").data("name"),q=a(".wsuwp-profile-degrees .wsuwp-profile-add-repeatable"),r=q.find("a").data("label"),s=q.find("a").data("name");g.focus().val(c.title.rendered),j.html(c.first_name),k.html(c.last_name),l.html(c.position_title),m.html(c.office),n.html(c.address),o.html(c.phone),p.html(c.email),a("#_wsuwp_profile_alt_office").val(c.office_alt),a("#_wsuwp_profile_alt_phone").val(c.phone_alt),a("#_wsuwp_profile_alt_email").val(c.email_alt),a("#_wsuwp_profile_website").val(c.website),b.tinymce.get("content").setContent(c.content.rendered),b.tinymce.get("_wsuwp_profile_bio_unit").setContent(c.bio_unit),b.tinymce.get("_wsuwp_profile_bio_university").setContent(c.bio_university),a("[name='_wsuwp_profile_title[]']").val(c.working_titles[0]),a.each(c.working_titles,function(a,b){a>0&&f.before(e({label:h,name:i,value:b}))}),a("[name='_wsuwp_profile_degree[]']").val(c.degree[0]),a.each(c.degree,function(a,b){a>0&&q.before(e({label:r,name:s,value:b}))}),0!==c._embedded["wp:photos"]&&a.each(c._embedded["wp:photos"],function(a,b){d(b)}),c._embedded["wp:featuredmedia"]&&0!==c._embedded["wp:featuredmedia"]&&d(c._embedded["wp:featuredmedia"][0])}function d(a){var b=a.media_details,c=b.sizes.thumbnail,d=c?b.sizes.thumbnail.source_url:a.source_url,e=c?b.sizes.thumbnail.width:b.width,g=c?b.sizes.thumbnail.height:b.height;y.append(f({src:d,width:e,height:g,id:a.id,alt:a.alt,url:a.source_url,title:a.title.rendered,full_width:b.width,full_height:b.height}))}var e=_.template(a(".wsuwp-profile-repeatable-field-template").html()),f=_.template(a("#photo-template").html()),g=a("#title"),h=a("#_wsuwp_profile_ad_nid"),i=a(".profile-card-data"),j=a("#_wsuwp_profile_ad_name_first"),k=a("#_wsuwp_profile_ad_name_last"),l=a("#_wsuwp_profile_ad_title"),m=a("#_wsuwp_profile_ad_office"),n=a("#_wsuwp_profile_ad_address"),o=a("#_wsuwp_profile_ad_phone"),p=a("#_wsuwp_profile_ad_email"),q=a("#confirm-ad-hash"),r=a("#load-ad-data"),s=a("#confirm-ad-data"),t=a("#refresh-ad-data"),u=a("#undo-ad-data-refresh");a("#wsuwp-profile-tabs").tabs({active:0}),a(".wsuwp-profile-add-repeatable").on("click","a",function(b){b.preventDefault(),a(this).closest("p").before(e({label:a(this).data("label"),name:a(this).data("name"),value:""}))}),a(".wsuwp-profile-repeatable-field").on("click",".wsuwp-profile-remove-repeatable-field",function(b){b.preventDefault(),a(this).closest("p").remove()}),a("#load-ad-data, #refresh-ad-data").on("click",function(d){if(""===h.val())return void b.alert("Please enter a Network ID");a(d.target).is("#refresh-ad-data")&&i.each(function(){a(this).data("original",a(this).html())});var e={action:"wsu_people_get_data_by_nid",_ajax_nonce:b.wsupeople.nid_nonce,network_id:h.val(),source:a(d.target).is("#refresh-ad-data")?"refresh":b.wsupeople.request_from};a.post(b.ajaxurl,e,function(a){return a.success?(a.data.id?c(a.data):(j.html(a.data.given_name),k.html(a.data.surname),l.html(a.data.title),m.html(a.data.office),n.html(a.data.street_address),o.html(a.data.telephone_number),p.html(a.data.email),q.val(a.data.confirm_ad_hash)),s.removeClass("profile-hide-button"),u.removeClass("profile-hide-button"),void t.addClass("profile-hide-button")):void b.alert(a.data)})}),s.on("click",function(){var c={action:"wsu_people_confirm_nid_data",_ajax_nonce:b.wsupeople.nid_nonce,network_id:h.val(),confirm_ad_hash:q.val(),post_id:a("#post_ID").val(),source:b.wsupeople.request_from},d=a(".load-ad-container .description"),e=a("#publish");a("#post_name").val(a("#_wsuwp_profile_ad_name_first").html().toLowerCase()+"-"+a("#_wsuwp_profile_ad_name_last").html().toLowerCase()),a.post(b.ajaxurl,c,function(b){b.success&&(""===g.val()&&(g.focus(),g.val(a("#_wsuwp_profile_ad_name_first").html()+" "+a("#_wsuwp_profile_ad_name_last").html())),h.attr("readonly",!0),d.html("The WSU Network ID used to populate this profile's data from Active Directory."),r.addClass("profile-hide-button"),s.addClass("profile-hide-button"),e.removeClass("profile-hide-button"),u.addClass("profile-hide-button"))})}),u.on("click",function(){i.each(function(){a(this).html(a(this).data("original"))}),s.addClass("profile-hide-button"),u.addClass("profile-hide-button"),t.removeClass("profile-hide-button")});var v,w,x=a(".wsuwp-profile-add-photo"),y=a(".wsuwp-profile-photo-collection"),z=a(".wsuwp-profile-photo-controls-tooltip");x.on("click",function(c){return c.preventDefault(),v?void v.open():(v=b.wp.media({title:"Select or Upload Your Photos",multiple:!0,library:{type:"image",uploadedTo:b.wsupeople.post_id},button:{text:"Use photo(s)"}}),v.on("select",function(){var b=v.state().get("selection"),c=[];a(".wsuwp-profile-photo-id").each(function(){c.push(parseInt(a(this).val()))}),a.each(b.models,function(b,d){var e=d.toJSON(),g=e.sizes.hasOwnProperty("thumbnail"),h=g?e.sizes.thumbnail.url:e.url,i=g?e.sizes.thumbnail.width:e.width,j=g?e.sizes.thumbnail.height:e.height;-1===a.inArray(e.id,c)&&y.append(f({src:h,width:i,height:j,id:e.id,alt:e.alt,url:e.url,title:e.title,full_width:e.width,full_height:e.height}))})}),void v.open())}),a("html").click(function(b){a(b.target).hasClass("wsuwp-profile-photo")?(a(b.target).next(".wsuwp-profile-photo-controls").show(),a(b.target).closest(".wsuwp-profile-photo-wrapper").siblings(".wsuwp-profile-photo-wrapper").find(".wsuwp-profile-photo-controls").hide()):a(".wsuwp-profile-photo-controls").hide()}),y.on("mouseover",".wsuwp-profile-photo-controls button",function(){var a=this.getAttribute("aria-label"),b=this.getBoundingClientRect(),c=y[0].getBoundingClientRect();z.find(".wsuwp-profile-photo-controls-tooltip-inner").html(a),z.css({top:b.bottom-c.top+"px",left:b.right-c.left-z.width()/2-6+"px"}).show()}),y.on("mouseleave",".wsuwp-profile-photo-controls button",function(){z.hide()}),y.on("click",".wsuwp-profile-photo-edit",function(c){c.preventDefault(),z.hide();var d=a(this).closest(".wsuwp-profile-photo-wrapper").find("img"),e={attachment_id:d.data("id"),size:"full",caption:"",align:"none",extraClasses:"",link:!1,title:d.attr("title"),url:d.data("url"),alt:d.attr("alt"),width:d.data("width"),height:d.data("height")};return w?void w.open():(b.wp.media.events.trigger("editor:image-edit",{metadata:e,image:d}),w=b.wp.media({frame:"image",state:"image-details",metadata:e}),w.on("close",function(){var a=w.state().image.attributes;d.attr("title",a.title),d.attr("alt",a.alt),d.data("width",a.width),d.data("height",a.height)}),void w.open())}),y.on("click",".wsuwp-profile-photo-remove",function(b){b.preventDefault(),z.hide(),a(this).closest(".wsuwp-profile-photo-wrapper").remove()})})}(jQuery,window,document);