!function(a,b,c){a(c).ready(function(){function c(){return a(".wsuwp-profile-photo-id").map(function(){return parseInt(a(this).val())}).get()}function d(c){var d=a(".wsuwp-profile-titles .wsuwp-profile-add-repeatable"),g=d.find("a").data("label"),h=d.find("a").data("name"),i=a(".wsuwp-profile-degrees .wsuwp-profile-add-repeatable"),k=i.find("a").data("label"),l=i.find("a").data("name");j.focus().val(c.title.rendered),m.html(c.first_name),n.html(c.last_name),o.html(c.position_title),p.html(c.office),q.html(c.address),r.html(c.phone),s.html(c.email),a("#_wsuwp_profile_alt_office").val(c.office_alt),a("#_wsuwp_profile_alt_phone").val(c.phone_alt),a("#_wsuwp_profile_alt_email").val(c.email_alt),a("#_wsuwp_profile_website").val(c.website),b.tinymce.get("content").setContent(c.content.rendered),b.tinymce.get("_wsuwp_profile_bio_unit").setContent(c.bio_unit),b.tinymce.get("_wsuwp_profile_bio_university").setContent(c.bio_university),a.each(c.working_titles,function(b,c){var e=a("[name='_wsuwp_profile_title[]']")[b];e?a(e).val(c):d.before(f({label:g,name:h,value:c}))}),a.each(c.degree,function(b,c){var d=a("[name='_wsuwp_profile_degree[]']")[b];d?a(d).val(c):i.before(f({label:k,name:l,value:c}))}),0!==c._embedded["wp:photos"]&&a.each(c._embedded["wp:photos"],function(a,b){e(b)}),c._embedded["wp:featuredmedia"]&&0!==c._embedded["wp:featuredmedia"]&&e(c._embedded["wp:featuredmedia"][0]),c._embedded["wp:term"]&&0!==c._embedded["wp:term"]&&(a.each(c._embedded["wp:term"],function(b,c){c&&a.each(c,function(b,c){"post_tag"===c.taxonomy?a("#new-tag-post_tag").val(function(a,b){return b+c.name+", "}):a("#"+c.taxonomy+"-all").find(".selectit:contains('"+c.name+"')").find("input[type='checkbox']").prop("checked",!0)})}),a(".tagadd").trigger("click"),j.focus())}function e(b){var d=b.media_details,e=d.sizes.thumbnail,f=e?d.sizes.thumbnail.source_url:b.source_url,h=e?d.sizes.thumbnail.width:d.width,i=e?d.sizes.thumbnail.height:d.height;-1===a.inArray(b.id,c())&&u.append(g({src:f,width:h,height:i,id:b.id,alt:b.alt,url:b.source_url,title:b.title.rendered,full_width:d.width,full_height:d.height}))}var f=_.template(a(".wsuwp-profile-repeatable-field-template").html()),g=_.template(a("#photo-template").html()),h=a("#publishing-action .spinner"),i=a(".refresh-card .spinner"),j=a("#title"),k=a("#_wsuwp_profile_ad_nid"),l=a(".profile-card-data"),m=a("#_wsuwp_profile_ad_name_first"),n=a("#_wsuwp_profile_ad_name_last"),o=a("#_wsuwp_profile_ad_title"),p=a("#_wsuwp_profile_ad_office"),q=a("#_wsuwp_profile_ad_address"),r=a("#_wsuwp_profile_ad_phone"),s=a("#_wsuwp_profile_ad_email"),t=a("#confirm-ad-hash"),u=a(".wsuwp-profile-photo-collection"),v=a("#load-ad-data"),w=a("#confirm-ad-data"),x=a("#refresh-ad-data"),y=a("#undo-ad-data-refresh");a("#wsuwp-profile-tabs").tabs({active:0}),b.wsupeople.make_request&&jQuery.ajax({url:b.wsupeople.rest_url,data:{_embed:!0,wsu_nid:k.val()}}).done(function(a){0!==a.length&&d(a[0])}),a(".wsuwp-profile-add-repeatable").on("click","a",function(b){b.preventDefault(),a(this).closest("p").before(f({label:a(this).data("label"),name:a(this).data("name"),value:""}))}),a(".wsuwp-profile-repeatable-field").on("click",".wsuwp-profile-remove-repeatable-field",function(b){b.preventDefault(),a(this).closest("p").remove()}),a("#load-ad-data, #refresh-ad-data").on("click",function(c){if(c.preventDefault(),c.target.disabled=!0,""===k.val())return void b.alert("Please enter a Network ID");a(c.target).is("#refresh-ad-data")?(i.css("visibility","visible"),l.each(function(){a(this).data("original",a(this).html())})):h.css("visibility","visible");var e={action:"wsu_people_get_data_by_nid",_ajax_nonce:b.wsupeople.nid_nonce,network_id:k.val(),request_from:b.wsupeople.request_from,is_refresh:a(c.target).is("#refresh-ad-data")?"true":"false"};a.post(b.ajaxurl,e,function(e){if(a(".spinner").css("visibility","hidden"),c.target.disabled=!1,!e.success)return void b.alert(e.data);e.data.id?d(e.data):(m.html(e.data.given_name),n.html(e.data.surname),o.html(e.data.title),p.html(e.data.office),q.html(e.data.street_address),r.html(e.data.telephone_number),s.html(e.data.email),t.val(e.data.confirm_ad_hash)),w.removeClass("profile-hide-button"),y.removeClass("profile-hide-button"),x.addClass("profile-hide-button")})}),w.on("click",function(c){c.preventDefault(),c.target.disabled=!0,a(c.target).hasClass("refresh")?(i.css("visibility","visible"),y.addClass("profile-hide-button")):(h.css("visibility","visible"),v.addClass("profile-hide-button"));var d={action:"wsu_people_confirm_nid_data",_ajax_nonce:b.wsupeople.nid_nonce,network_id:k.val(),confirm_ad_hash:t.val(),post_id:a("#post_ID").val(),request_from:b.wsupeople.request_from},e=a(".load-ad-container .description"),f=a("#publish");a.post(b.ajaxurl,d,function(b){b.success&&(""===j.val()&&(j.focus(),j.val(a("#_wsuwp_profile_ad_name_first").html()+" "+a("#_wsuwp_profile_ad_name_last").html())),k.attr("readonly",!0),e.html("The WSU Network ID used to populate this profile's data from Active Directory."),a(".spinner").css("visibility","hidden"),w.addClass("profile-hide-button"),f.removeClass("profile-hide-button"))})}),y.on("click",function(b){b.preventDefault(),l.each(function(){a(this).html(a(this).data("original"))}),w.addClass("profile-hide-button"),y.addClass("profile-hide-button"),x.removeClass("profile-hide-button").disabled=!1});var z,A=a(".wsuwp-profile-add-photo"),B=a(".wsuwp-profile-photo-controls-tooltip");A.on("click",function(d){if(d.preventDefault(),z)return void z.open();z=b.wp.media({title:"Select or Upload Your Photos",multiple:!0,library:{type:"image",uploadedTo:b.wsupeople.post_id},button:{text:"Use photo(s)"}}),z.on("select",function(){var b=z.state().get("selection");a.each(b.models,function(b,d){var e=d.toJSON(),f=e.sizes.hasOwnProperty("thumbnail"),h=f?e.sizes.thumbnail.url:e.url,i=f?e.sizes.thumbnail.width:e.width,j=f?e.sizes.thumbnail.height:e.height;-1===a.inArray(e.id,c())&&u.append(g({src:h,width:i,height:j,id:e.id,alt:e.alt,url:e.url,title:e.title,full_width:e.width,full_height:e.height}))})}),z.open()}),u.on("mouseover",".wsuwp-profile-photo-controls button",function(){var a=this.getAttribute("aria-label"),b=this.getBoundingClientRect(),c=u[0].getBoundingClientRect();B.css({top:b.bottom-c.top+"px",left:b.right-c.left-B.width()/2-6+"px"}).show().find(".wsuwp-profile-photo-controls-tooltip-inner").html(a)}),u.on("mouseleave",".wsuwp-profile-photo-controls button",function(){B.hide()}),u.on("click",".wsuwp-profile-photo-remove",function(){B.hide(),a(this).closest(".wsuwp-profile-photo-wrapper").remove()}),u.on("click",".wsuwp-profile-photo-select",function(){var b=a(this).closest(".wsuwp-profile-photo-wrapper"),c=a(".use-photo");b.toggleClass("selected").siblings().removeClass("selected"),b.hasClass("selected")?c.val(a(".wsuwp-profile-photo-wrapper").index(b)):c.val("")})})}(jQuery,window,document);