!function(a,b,c){a(c).ready(function(){a("#wsuwp-profile-tabs").tabs({active:0});var c=_.template(a(".wsuwp-profile-repeatable-field-template").html());a(".wsuwp-profile-add-repeatable").on("click","a",function(b){b.preventDefault(),a(this).closest("p").before(c({label:a(this).data("label"),name:a(this).data("name")}))}),a(".wsuwp-profile-repeatable-field").on("click",".wsuwp-profile-remove-repeatable-field",function(b){b.preventDefault(),a(this).closest("p").remove()}),a("#load-ad-data").on("click",function(){var c=a("#_wsuwp_profile_ad_name_first"),d=a("#_wsuwp_profile_ad_name_last"),e=a("#_wsuwp_profile_ad_title"),f=a("#_wsuwp_profile_ad_office"),g=a("#_wsuwp_profile_ad_address"),h=a("#_wsuwp_profile_ad_phone"),i=a("#_wsuwp_profile_ad_email"),j=a("#confirm-ad-hash"),k=a("#confirm-ad-data"),l={action:"wsu_people_get_data_by_nid",_ajax_nonce:b.wsupeople.nid_nonce,network_id:a("#_wsuwp_profile_ad_nid").val()};a.post(b.ajaxurl,l,function(a){a.success&&(c.html(a.data.given_name),d.html(a.data.surname),e.html(a.data.title),f.html(a.data.office),g.html(a.data.street_address),h.html(a.data.telephone_number),i.html(a.data.email),j.val(a.data.confirm_ad_hash),k.removeClass("profile-hide-button"))})}),a("#confirm-ad-data").on("click",function(){var c={action:"wsu_people_confirm_nid_data",_ajax_nonce:b.wsupeople_nid_nonce,network_id:a("#_wsuwp_profile_ad_nid").val(),confirm_ad_hash:a("#confirm-ad-hash").val(),post_id:a("#post_ID").val()},d=a("#title");a.post(b.ajaxurl,c,function(b){b.success&&(""===d.val()&&(d.focus(),d.val(a("#_wsuwp_profile_ad_name_first").html()+" "+a("#_wsuwp_profile_ad_name_last").html())),a("#_wsuwp_profile_ad_nid").attr("readonly",!0),a(".load-ad-container .description").html("The WSU Network ID used to populate this profile's data from Active Directory."),a("#load-ad-data").addClass("profile-hide-button"),a("#confirm-ad-data").addClass("profile-hide-button"),a("#publish").removeClass("profile-hide-button"))})});var d,e,f=a(".wsuwp-profile-add-photo"),g=a(".wsuwp-profile-photo-collection"),h=a(".wsuwp-profile-photo-count"),i=a(".wsuwp-profile-photo-controls-tooltip");f.on("click",function(c){return c.preventDefault(),d?void d.open():(d=b.wp.media({title:"Select or Upload Your Photos",multiple:!0,library:{type:"image",uploadedTo:b.wsupeople.post_id},button:{text:"Use photo(s)"}}),d.on("select",function(){var b=d.state().get("selection"),c=_.template(a("#photo-template").html()),e=[];a(".wsuwp-profile-photo-id").each(function(){e.push(parseInt(a(this).val()))}),a.each(b.models,function(b,d){var f=Number(h.val())+b,i=d.toJSON(),j=i.sizes.hasOwnProperty("thumbnail"),k=j?i.sizes.thumbnail.url:i.url,l=j?i.sizes.thumbnail.width:i.width,m=j?i.sizes.thumbnail.height:i.height;-1===a.inArray(i.id,e)&&g.append(c({src:k,width:l,height:m,count:f,id:i.id,alt:i.alt,url:i.url,title:i.title,full_width:i.width,full_height:i.height}))}),h.val(g.find(".wsuwp-profile-photo-wrapper").length)}),void d.open())}),a("html").click(function(b){a(b.target).hasClass("wsuwp-profile-photo")?(a(b.target).next(".wsuwp-profile-photo-controls").show(),a(b.target).closest(".wsuwp-profile-photo-wrapper").siblings(".wsuwp-profile-photo-wrapper").find(".wsuwp-profile-photo-controls").hide()):a(".wsuwp-profile-photo-controls").hide()}),g.on("mouseover",".wsuwp-profile-photo-controls button",function(){var a=this.getAttribute("aria-label"),b=this.getBoundingClientRect(),c=g[0].getBoundingClientRect();i.find(".wsuwp-profile-photo-controls-tooltip-inner").html(a),i.css({top:b.bottom-c.top+"px",left:b.right-c.left-i.width()/2-6+"px"}).show()}),g.on("mouseleave",".wsuwp-profile-photo-controls button",function(){i.hide()}),g.on("click",".wsuwp-profile-photo-edit",function(c){c.preventDefault(),i.hide();var d=a(this).closest(".wsuwp-profile-photo-wrapper").find("img"),f={attachment_id:d.data("id"),size:"full",caption:"",align:"none",extraClasses:"",link:!1,title:d.attr("title"),url:d.data("url"),alt:d.attr("alt"),width:d.data("width"),height:d.data("height")};return e?void e.open():(b.wp.media.events.trigger("editor:image-edit",{metadata:f,image:d}),e=b.wp.media({frame:"image",state:"image-details",metadata:f}),e.on("close",function(){var a=e.state().image.attributes;d.attr("title",a.title),d.attr("alt",a.alt),d.data("width",a.width),d.data("height",a.height)}),void e.open())}),g.on("click",".wsuwp-profile-photo-remove",function(b){b.preventDefault(),i.hide(),a(this).closest(".wsuwp-profile-photo-wrapper").remove();for(var c=a(".wsuwp-profile-photo-id"),d=0;d<c.length;d++)a(c[d]).attr("name","photos["+d+"]");h.val(c.length)})})}(jQuery,window,document);