var wsuwp=wsuwp||{};wsuwp.people=wsuwp.people||{},function(e,t,o,l){l.people.rest_response_complete=!1,l.people.titles="",l.people.degrees="",l.people.bio_content={content:"",_wsuwp_profile_bio_unit:"",_wsuwp_profile_bio_university:""},l.people.populate_editor=function(e){!1!==l.people.rest_response_complete?t.tinymce.get(e.id).setContent(l.people.bio_content[e.id]):setTimeout(l.people.populate_editor.bind(null,e),200)},l.people.populate_person_from_people_directory=function(e){var o=jQuery,i=_.template(o(".wsuwp-profile-repeatable-field-template").html()),p=o(".wsuwp-profile-titles .wsuwp-profile-add-repeatable"),a=p.find("a").data("label"),s=p.find("a").data("name"),n=o(".wsuwp-profile-degrees .wsuwp-profile-add-repeatable"),r=n.find("a").data("label"),d=n.find("a").data("name");o("#_wsuwp_profile_post_id").val(e.id),o("#title").focus().val(e.title.rendered).data("original",e.title.rendered),o("#_wsuwp_profile_ad_name_first").html(e.first_name),o("#_wsuwp_profile_ad_name_last").html(e.last_name),o("#_wsuwp_profile_ad_title").html(e.position_title),o("#_wsuwp_profile_ad_office").html(e.office),o("#_wsuwp_profile_ad_address").html(e.address),o("#_wsuwp_profile_ad_phone").html(e.phone),o("#_wsuwp_profile_ad_email").html(e.email),o("#_wsuwp_profile_alt_office").val(e.office_alt).data("original",e.office_alt),o("#_wsuwp_profile_alt_phone").val(e.phone_alt).data("original",e.phone_alt),o("#_wsuwp_profile_alt_email").val(e.email_alt).data("original",e.email_alt),o("#_wsuwp_profile_website").val(e.website).data("original",e.website),l.people.bio_content.content=e.content.rendered,l.people.bio_content._wsuwp_profile_bio_unit=e.bio_unit,l.people.bio_content._wsuwp_profile_bio_university=e.bio_university;var u=o("#bio_unit .readonly"),w=o("#bio_university .readonly");if(0!==u.length&&u.html(l.people.bio_content._wsuwp_profile_bio_unit),0!==w&&w.html(l.people.bio_content._wsuwp_profile_bio_university),l.people.rest_response_complete=!0,o.each(e.working_titles,function(e,t){var l=o("[name='_wsuwp_profile_title[]']")[e];l?o(l).val(t):p.before(i({label:a,name:s,value:t}))}),l.people.titles=e.working_titles,""!==o(".use-title").val()){var c=o(".use-title").val().split(" ");o.each(c,function(e,t){o(".wsuwp-profile-titles p").eq(t).addClass("selected").find(".screen-reader-text").text("Deselect")})}o.each(e.degree,function(e,t){var l=o("[name='_wsuwp_profile_degree[]']")[e];l?o(l).val(t):n.before(i({label:r,name:d,value:t}))}),l.people.degrees=e.degree,e._embedded&&0!==e._embedded["wp:photos"]&&o.each(e._embedded["wp:photos"],function(e,t){l.people.populate_photos(t)}),e._embedded&&e._embedded["wp:featuredmedia"]&&0!==e._embedded["wp:featuredmedia"]&&l.people.populate_photos(e._embedded["wp:featuredmedia"][0]),""!==o(".use-photo").val()?o(".wsuwp-profile-photo-wrapper").eq(o(".use-photo").val()).addClass("selected").find(".wsuwp-profile-photo-select").attr("aria-label","Deselect"):o(".wsuwp-profile-photo-wrapper").eq(0).addClass("selected").find(".wsuwp-profile-photo-select").attr("aria-label","Deselect"),e._embedded&&e._embedded["wp:term"]&&0!==e._embedded["wp:term"]&&(o.each(e._embedded["wp:term"],function(e,t){t&&o.each(t,function(e,t){"post_tag"===t.taxonomy?o("#new-tag-post_tag").val(function(e,o){return o+t.name+", "}):o("#"+t.taxonomy+"-all").find(".selectit:contains('"+t.name+"')").find("input[type='checkbox']").prop("checked",!0)})}),o(".tagadd").trigger("click"),o("#title").focus()),o.ajax({url:t.wsuwp_people_edit_profile_secondary.rest_url+"/"+e.id,type:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",t.wsuwp_people_edit_profile_secondary.nonce),e.setRequestHeader("X-WSUWP-UID",t.wsuwp_people_edit_profile_secondary.uid)},error:function(){o("#wsuwp_profile_additional_info input").prop("disabled",!0),o(".wsuwp-profile-button.remove").prop("disabled",!0),o("#new-tag-post_tag").prop("disabled",!0),o(".tabs-panel input").prop("disabled",!0),o(".wsuwp-profile-add-photo").prop("disabled",!0),o(".wsuwp-profile-photo-remove").prop("disabled",!0),t.tinymce.get("content").setMode("readonly"),0===u.length&&t.tinymce.get("_wsuwp_profile_bio_unit").setMode("readonly"),0===w.length&&t.tinymce.get("_wsuwp_profile_bio_university").setMode("readonly")}})},l.people.populate_photos=function(e){var t=jQuery,o=_.template(t("#photo-template").html()),l=e.media_details,i=l.sizes.thumbnail,p=i?l.sizes.thumbnail.source_url:e.source_url,a=i?l.sizes.thumbnail.width:l.width,s=i?l.sizes.thumbnail.height:l.height;-1===t.inArray(e.id,existing_photos())&&t(".wsuwp-profile-photo-collection").append(o({src:p,width:a,height:s,id:e.id,alt:e.alt,url:e.source_url,title:e.title.rendered,full_width:l.width,full_height:l.height}))},e(o).ready(function(){var o=e("#_wsuwp_profile_ad_nid"),i=e("#_wsuwp_profile_post_id").val();t.wsuwp_people_edit_profile_secondary.load_data&&e.ajax({url:t.wsuwp_people_edit_profile_secondary.rest_url,data:{_embed:!0,wsu_nid:o.val()}}).done(function(e){0!==e.length&&l.people.populate_person_from_people_directory(e[0])}),e(".wsuwp-profile-about-tabs").on("click",".select",function(){var t=e(this).closest("li"),o=e(".use-bio");t.toggleClass("selected"),t.hasClass("selected")?(o.val(t.data("bio")),t.find(".screen-reader-text").text("Deselect"),t.siblings().removeClass("selected").find(".screen-reader-text").text("Select")):(o.val(""),t.find(".screen-reader-text").text("Select"))}),e(".wsuwp-profile-titles").on("click",".select",function(){var t=e(this).closest("p");t.toggleClass("selected");var o=e(".wsuwp-profile-titles .selected").map(function(){return e(this).index()}).get();e(".use-title").val(o.join(" ")),t.hasClass("selected")?t.find(".screen-reader-text").text("Deselect"):t.find(".screen-reader-text").text("Select")}),e(".wsuwp-profile-photo-collection").on("click",".wsuwp-profile-photo-select",function(){var t=e(this),o=t.closest(".wsuwp-profile-photo-wrapper"),l=e(".use-photo");o.toggleClass("selected").siblings().removeClass("selected"),o.hasClass("selected")?(l.val(e(".wsuwp-profile-photo-wrapper").index(o)),t.attr("aria-label","Deselect"),o.siblings().removeClass("selected").find(".wsuwp-profile-photo-select").attr("aria-label","Select")):(l.val(""),t.attr("aria-label","Select"))}),e("#publish").on("click",function(){var o={},p=e("#title"),a=e("#_wsuwp_profile_alt_office"),s=e("#_wsuwp_profile_alt_phone"),n=e("#_wsuwp_profile_alt_email"),r=e("#_wsuwp_profile_website"),_=e("[name='_wsuwp_profile_title[]']"),d=e("[name='_wsuwp_profile_degree[]']"),u=t.tinymce.get("content"),w=t.tinymce.get("_wsuwp_profile_bio_unit"),c=t.tinymce.get("_wsuwp_profile_bio_university");if(p.val()!==p.data("original")&&(o.title=p.val()),a.val()!==a.data("original")&&(o.office_alt=a.val()),s.val()!==s.data("original")&&(o.phone_alt=s.val()),n.val()!==n.data("original")&&(o.email_alt=n.val()),r.val()!==r.data("original")&&(o.website=r.val()),_){var f=_.map(function(){return e(this).val()}).get();f.join(",")!==l.people.titles.join(",")&&(o.working_titles=f)}if(d){var m=d.map(function(){return e(this).val()}).get();m.join(",")!==l.people.degrees.join(",")&&(o.degree=m)}u&&u.getContent()!==l.people.bio_content.content&&(o.content=u.getContent()),w&&w.getContent()!==l.people.bio_content._wsuwp_profile_bio_unit&&(o.bio_unit=w.getContent()),c&&c.getContent()!==l.people.bio_content._wsuwp_profile_bio_university&&(o.bio_university=c.getContent()),e.isEmptyObject(o)||e.ajax({url:t.wsuwp_people_edit_profile_secondary.rest_url+"/"+i,method:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",t.wsuwp_people_edit_profile_secondary.nonce),e.setRequestHeader("X-WSUWP-UID",t.wsuwp_people_edit_profile_secondary.uid)},data:o})})})}(jQuery,window,document,wsuwp);