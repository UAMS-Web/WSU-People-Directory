var wsuwp=wsuwp||{};wsuwp.people=wsuwp.people||{},function(e,t,i,o){o.people.rest_response_complete=!1,o.people.titles="",o.people.degrees="",o.people.bio_content={content:"",_wsuwp_profile_bio_unit:"",_wsuwp_profile_bio_university:""},o.people.populate_editor=function(e){!1!==o.people.rest_response_complete?(t.tinymce.get(e.id).setContent(o.people.bio_content[e.id]),t.tinymce.get("_wsuwp_profile_bio_unit")&&t.tinymce.get("_wsuwp_profile_bio_unit").setMode("readonly"),t.tinymce.get("_wsuwp_profile_bio_university")&&t.tinymce.get("_wsuwp_profile_bio_university").setMode("readonly")):setTimeout(o.people.populate_editor.bind(null,e),200)},o.people.populate_person_from_people_directory=function(e){var i=jQuery,n=_.template(i(".wsu-person-repeatable-meta-template").html()),s=i(".wsu-person-title .wsu-person-add-repeatable-meta"),r=i(".wsu-person-degree .wsu-person-add-repeatable-meta");if(i(".wsu-person").attr("data-nid",e.nid),i("#_wsuwp_profile_post_id").val(e.id),i(".wsu-person-name").text(e.title.rendered).data("original",e.title.rendered).next("input").val(e.title.rendered),i(".wsu-person-email").text(e.email_alt).data("original",e.email_alt).next("input").val(e.email_alt),i(".wsu-person-phone").text(e.phone_alt).data("original",e.phone_alt).next("input").val(e.phone_alt),i(".wsu-person-office").text(e.office_alt).data("original",e.office_alt).next("input").val(e.office_alt),i(".wsu-person-address").text(e.address_alt).data("original",e.address_alt).next("input").val(e.address_alt),i(".wsu-person-website").text(e.website).data("original",e.website).next("input").val(e.website),o.people.bio_content.content=e.content.rendered,o.people.bio_content._wsuwp_profile_bio_unit=e.bio_unit,o.people.bio_content._wsuwp_profile_bio_university=e.bio_university,i("#bio_unit .readonly").html(e.bio_unit),i("#bio_university .readonly").html(e.bio_university),o.people.rest_response_complete=!0,i.each(e.working_titles,function(e,t){var o=i(".wsu-person-title > div")[e];o?i(o).find("div").text(t).next("input").val(t):s.before(n({type:s.data("type"),value:t}))}),o.people.titles=e.working_titles,""!==i(".use-title").val()){var p=i(".use-title").val().split(" ");i.each(p,function(e,t){i(".wsu-person-title .wsu-person-repeatable-meta-entry").eq(t).addClass("selected").find(".screen-reader-text").text("Deselect")})}i.each(e.degree,function(e,t){var o=i(".wsu-person-degree > div")[e];o?i(o).find("div").text(t).next("input").val(t):r.before(n({type:r.data("type"),value:t}))}),o.people.degrees=e.degree,e._embedded&&e._embedded["wp:term"]&&0!==e._embedded["wp:term"]&&(i.each(e._embedded["wp:term"],function(e,t){t&&i.each(t,function(e,t){"post_tag"===t.taxonomy?i("#new-tag-post_tag").val(function(e,i){return i+t.name+", "}):i("#"+t.taxonomy+"-all").find(".selectit:contains('"+t.name+"')").find("input[type='checkbox']").prop("checked",!0)})}),i(".tagadd").trigger("click"),i(".wsu-person-name").focus()),i.ajax({url:t.wsuwp_people_edit_profile_secondary.rest_url+"/"+e.id,type:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",t.wsuwp_people_edit_profile_secondary.nonce),e.setRequestHeader("X-WSUWP-UID",t.wsuwp_people_edit_profile_secondary.uid)},error:function(){i(".wsu-person-card [contenteditable='true']").prop("contenteditable",!1),i(".wsu-person-remove").remove(),i(".wsu-person-add-repeatable-meta").remove(),i("#new-tag-post_tag").prop("disabled",!0),t.tinymce.get("content").setMode("readonly")}})},o.people.populate_photos=function(e){var t=jQuery,i=_.template(t("#photo-template").html()),o=e.media_details,n=o.sizes.thumbnail,s=n?o.sizes.thumbnail.source_url:e.source_url,r=n?o.sizes.thumbnail.width:o.width,p=n?o.sizes.thumbnail.height:o.height;-1===t.inArray(e.id,existing_photos())&&t(".wsuwp-profile-photo-collection").append(i({src:s,width:r,height:p,id:e.id,alt:e.alt,url:e.source_url,title:e.title.rendered,full_width:o.width,full_height:o.height}))},e(i).ready(function(){var i=e("#_wsuwp_profile_ad_nid"),n=e("#_wsuwp_profile_post_id").val();t.wsuwp_people_edit_profile_secondary.load_data&&e.ajax({url:t.wsuwp_people_edit_profile_secondary.rest_url,data:{_embed:!0,wsu_nid:i.val()}}).done(function(e){0!==e.length&&o.people.populate_person_from_people_directory(e[0])}),e(".wsuwp-profile-about-tabs").on("click",".select",function(){var t=e(this).closest("li"),i=e(".use-bio");t.toggleClass("selected"),t.hasClass("selected")?(i.val(t.data("bio")),t.find(".screen-reader-text").text("Deselect"),t.siblings().removeClass("selected").find(".screen-reader-text").text("Select")):(i.val(""),t.find(".screen-reader-text").text("Select"))}),e(".wsu-person-title").on("click",".wsu-person-select",function(){var t=e(this).closest(".wsu-person-repeatable-meta-entry");t.toggleClass("selected");var i=e(".wsu-person-title .selected").map(function(){return e(this).index()}).get();e(".use-title").val(i.join(" ")),t.hasClass("selected")?t.find(".screen-reader-text").text("Deselect"):t.find(".screen-reader-text").text("Select")}),e("#publish").on("click",function(){var i={},s=e(".wsu-person-name"),r=e(".wsu-person-email"),p=e(".wsu-person-phone"),l=e(".wsu-person-office"),a=e(".wsu-person-address"),d=e(".wsu-person-website"),_=e(".wsu-person-title > div > div"),u=e(".wsu-person-degree > div > div"),c=t.tinymce.get("content"),w=t.tinymce.get("_wsuwp_profile_bio_unit"),f=t.tinymce.get("_wsuwp_profile_bio_university");if(s.text()!==s.data("original")&&(i.title=s.text()),r.text()!==r.data("original")&&(i.email_alt=r.text()),p.text()!==p.data("original")&&(i.phone_alt=p.text()),l.text()!==l.data("original")&&(i.office_alt=l.text()),a.text()!==a.data("original")&&(i.address_alt=a.text()),d.text()!==d.data("original")&&(i.website=d.text()),_){var b=_.map(function(){return e(this).text()}).get();b.join(",")!==o.people.titles.join(",")&&(i.working_titles=b)}if(u){var m=u.map(function(){return e(this).text()}).get();m.join(",")!==o.people.degrees.join(",")&&(i.degree=m)}c&&c.getContent()!==o.people.bio_content.content&&(i.content=c.getContent()),w&&w.getContent()!==o.people.bio_content._wsuwp_profile_bio_unit&&(i.bio_unit=w.getContent()),f&&f.getContent()!==o.people.bio_content._wsuwp_profile_bio_university&&(i.bio_university=f.getContent()),e.isEmptyObject(i)||e.ajax({url:t.wsuwp_people_edit_profile_secondary.rest_url+"/"+n,method:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",t.wsuwp_people_edit_profile_secondary.nonce),e.setRequestHeader("X-WSUWP-UID",t.wsuwp_people_edit_profile_secondary.uid)},data:i})})})}(jQuery,window,document,wsuwp);