!function(a,b,c){function d(){a(".has-photo .photo img").each(function(){a(this).attr("src",a(this).data("photo"))})}function e(a){jQuery.ajax({url:b.wsupeople.rest_url,data:{"filter[wsuwp_university_org]":a.item.value,per_page:100}}).done(function(a){0!==a.length&&(a.sort(f),g(a),d())})}function f(a,b){return a.last_name<b.last_name?-1:a.last_name>b.last_name?1:0}function g(b){a.each(b,function(b,c){var d=a("#directory-page-nids"),e=o.find(".wsu-person").map(function(){return a(this).data("nid")}).get();-1===a.inArray(c.nid,e)&&(d.val(function(){return this.value+" "+c.nid}),a(".wsu-people").append(p({nid:c.nid,has_photo:0<c.photos.length?" has-photo":"",slug:c.slug,name:c.title.rendered,photo:0<c.photos.length?c.photos[0].thumbnail:"",title:0<c.working_titles.length?c.working_titles[0]:c.position_title,email:c.email_alt?c.email_alt:c.email,phone:c.phone_alt?c.phone_alt:c.phone+c.phone_ext,office:c.office_alt?c.office_alt:c.office,address:c.address,website:c.website,content:c.content.rendered})))})}function h(){var b=o.find(".wsu-person").map(function(){return a(this).data("nid")}).get();m.val(b.join(" "))}var i=a("#page_template"),j=a("#wsuwp-people-directory-configuration"),k=a("#postdivrich"),l=a("#wsu-people-import"),m=a("#directory-page-nids"),n=a("#wsuwp_university_orgchecklist .selectit").map(function(){return a(this).text()}).get(),o=a(".wsu-people"),p=_.template(a("#wsu-person-template").html());a(c).ready(function(){d(),i.on("change",function(){"templates/people.php"===a(this).val()?(j.show(),k.hide()):(j.hide(),"template-builder.php"!==a(this).val()&&k.show())}),l.autocomplete({source:n,select:function(a,b){e(b)}}),a(".wsu-people-bulk-actions").on("click",".toggle-select-mode",function(){"Bulk Select"===a(this).text()?(a(this).text("Cancel Selection"),a(".delete-selected-people").show(),a(".wsu-people-wrapper").addClass("bulk-select")):(a(this).text("Bulk Select"),a(".delete-selected-people").hide(),a(".wsu-people-wrapper").removeClass("bulk-select"))}),o.sortable({cursor:"move",start:function(a,b){b.placeholder.height(b.item.height())},stop:function(){h()}}),o.on("click",".wsu-person-edit",function(a){a.preventDefault()}),o.on("click",".wsu-person-remove",function(b){b.preventDefault(),a(this).closest(".wsu-person").remove(),h()})})}(jQuery,window,document);