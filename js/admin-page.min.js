!function(a,b,c){function d(a){jQuery.ajax({url:b.wsupeople.rest_url,data:{"filter[wsuwp_university_org]":a.item.value,per_page:100}}).done(function(a){0!==a.length&&(a.sort(e),f(a))})}function e(a,b){return a.last_name<b.last_name?-1:a.last_name>b.last_name?1:0}function f(b){a.each(b,function(b,c){var d=a("#directory-page-nids"),e=n.find(".wsu-person").map(function(){return a(this).data("nid")}).get();-1===a.inArray(c.nid,e)&&(d.val(function(){return this.value+" "+c.nid}),a(".wsu-people").append(o({nid:c.nid,has_photo:" has_photo",slug:c.slug,name:c.title.rendered,photo:"",title:c.working_titles[0]?c.working_titles[0]:c.position_title,email:c.email_alt?c.email_alt:c.email,phone:c.phone_alt?c.phone_alt:c.phone+c.phone_ext,office:c.office_alt?c.office_alt:c.office,address:c.address,website:c.website,content:c.content.rendered})))})}function g(){var b=n.find(".wsu-person").map(function(){return a(this).data("nid")}).get();l.val(b.join(" "))}var h=a("#page_template"),i=a("#wsuwp-people-directory-configuration"),j=a("#postdivrich"),k=a("#wsu-people-import"),l=a("#directory-page-nids"),m=a("#wsuwp_university_orgchecklist .selectit").map(function(){return a(this).text()}).get(),n=a(".wsu-people"),o=_.template(a("#wsu-person-template").html());a(c).ready(function(){h.on("change",function(){"templates/people.php"===a(this).val()?(i.show(),j.hide()):(i.hide(),"template-builder.php"!==a(this).val()&&j.show())}),k.autocomplete({source:m,select:function(a,b){d(b)}}),a(".wsu-people-bulk-actions").on("click",".toggle-select-mode",function(){"Bulk Select"===a(this).text()?(a(this).text("Cancel Selection"),a(".delete-selected-people").show(),a(".wsu-people-wrapper").addClass("bulk-select")):(a(this).text("Bulk Select"),a(".delete-selected-people").hide(),a(".wsu-people-wrapper").removeClass("bulk-select"))}),n.sortable({cursor:"move",start:function(a,b){b.placeholder.height(b.item.height())},stop:function(){g()}}),n.on("click",".wsu-person-edit",function(a){a.preventDefault()}),n.on("click",".wsu-person-remove",function(b){b.preventDefault(),a(this).closest(".wsu-person").remove(),g()})})}(jQuery,window,document);