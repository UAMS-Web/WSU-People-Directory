!function(a,b,c){function d(){a(".has-photo .photo img").each(function(){a(this).attr("src",a(this).data("photo"))})}function e(a){jQuery.ajax({url:b.wsupeople.rest_url,data:{"filter[wsuwp_university_org]":a.item.value,per_page:100}}).done(function(a){0!==a.length&&(a.sort(f),g(a),d())})}function f(a,b){return a.last_name<b.last_name?-1:a.last_name>b.last_name?1:0}function g(b){a.each(b,function(b,c){var d=a("#directory-page-nids"),e=u.find(".wsu-person").map(function(){return a(this).data("nid")}).get();-1===a.inArray(c.nid,e)&&(d.val(function(){return this.value+" "+c.nid}),a(".wsu-people").append(w({nid:c.nid,has_photo:0<c.photos.length?" has-photo":"",slug:c.slug,name:c.title.rendered,photo:0<c.photos.length?c.photos[0].thumbnail:"",title:0<c.working_titles.length?c.working_titles[0]:c.position_title,email:c.email_alt?c.email_alt:c.email,phone:c.phone_alt?c.phone_alt:c.phone+c.phone_ext,office:c.office_alt?c.office_alt:c.office,address:c.address,website:c.website,content:c.content.rendered})))})}function h(){var b=u.find(".wsu-person").map(function(){return a(this).data("nid")}).get();m.val(b.join(" "))}var i=a("#page_template"),j=a("#wsuwp-people-directory-configuration"),k=a("#postdivrich"),l=a("#wsu-people-import"),m=a("#directory-page-nids"),n=a("#wsu-people-directory-layout"),o=a("#wsu-people-directory-show-photos"),p=a("#wsuwp_university_orgchecklist .selectit").map(function(){return a(this).text()}).get(),q=a(".toggle-select-mode"),r=a(".select-all-people"),s=a(".delete-selected-people"),t=a(".wsu-people-wrapper"),u=a(".wsu-people"),v=a(".wsu-person-controls-tooltip"),w=_.template(a("#wsu-person-template").html());a(c).ready(function(){d(),i.on("change",function(){"templates/people.php"===a(this).val()?(j.show(),k.hide()):(j.hide(),"template-builder.php"!==a(this).val()&&k.show())}),l.autocomplete({source:p,select:function(a,b){e(b)}}),o.on("change",function(){"yes"===a(this).val()?t.addClass("photos"):t.removeClass("photos")}),n.on("change",function(){var b=a(this).val();n.find("option").not(":selected").each(function(){t.removeClass(a(this).val())}),t.addClass(b)}),u.sortable({cursor:"move",start:function(a,b){b.placeholder.height(b.item.height())},stop:function(){h()}}),q.on("click",function(){"Bulk Select"===a(this).text()?(a(this).text("Cancel Selection"),r.show(),s.show().prop("disabled",!0),t.addClass("bulk-select"),u.sortable("option","disabled",!0)):(a(this).text("Bulk Select"),r.hide(),s.hide().prop("disabled",!0),t.removeClass("bulk-select"),u.find(".wsu-person").removeClass("selected").attr("aria-checked","false"),u.sortable("option","disabled",!1))}),r.on("click",function(){"Select All"===a(this).text()?(a(this).text("Deselect All"),u.find(".wsu-person").addClass("selected").attr("aria-checked","true"),s.prop("disabled",!1)):(a(this).text("Select All"),u.find(".wsu-person").removeClass("selected").attr("aria-checked","false"),s.prop("disabled",!0))}),u.on("click",".wsu-person",function(){t.is(".bulk-select")&&(a(this).toggleClass("selected"),a(this).hasClass("selected")?a(this).attr("aria-checked","true"):a(this).attr("aria-checked","false"),0<u.find(".selected").length?s.prop("disabled",!1):(r.text("Select All"),s.prop("disabled",!0)),u.find(".wsu-person").length===u.find(".selected").length&&r.text("Deselect All"))}),s.on("click",function(){u.find(".selected").remove(),h()}),u.on("mouseover",".wsu-person-controls button",function(){var a=this.getAttribute("aria-label"),b=this.getBoundingClientRect(),c=u[0].getBoundingClientRect();v.find(".wsu-person-controls-tooltip-inner").html(a),v.css({top:b.bottom-c.top+"px",left:b.right-c.left-v.width()/2-b.width/2+"px"}).show()}),u.on("mouseleave",".wsu-person-controls button",function(){v.hide()}),u.on("click",".wsu-person-edit",function(a){a.preventDefault()}),u.on("click",".wsu-person-remove",function(b){b.preventDefault(),a(this).closest(".wsu-person").remove(),h()})})}(jQuery,window,document);