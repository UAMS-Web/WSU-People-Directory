!function(e,t,o){function s(){e(".has-photo .photo img").each(function(){e(this).attr("src",e(this).data("photo"))})}function n(o){x.html("<span class='spinner'></span>"),e.ajax({url:t.wsuwp_people_edit_page.rest_url,data:{"filter[wsuwp_university_org]":o.item.value,per_page:100}}).done(function(t){x.find(".spinner").remove(),0!==t.length&&(t.sort(i),l(t),s(),e(".wsu-people-directory-extra-options").slideDown())})}function i(e,t){return e.last_name<t.last_name?-1:e.last_name>t.last_name?1:0}function l(t){e.each(t,function(t,o){var s=x.find(".wsu-person").map(function(){return e(this).data("profile-id")}).get();-1===e.inArray(o.id,s)&&(u.val(function(){return this.value+" "+o.id}),x.append(j({nid:o.nid,id:o.id,has_photo:0<o.photos.length?" has-photo":"",slug:o.slug,name:o.title.rendered,photo:0<o.photos.length?o.photos[0].thumbnail:"",title:0<o.working_titles.length?o.working_titles[0]:o.position_title,email:o.email_alt?o.email_alt:o.email,phone:o.phone_alt?o.phone_alt:o.phone+o.phone_ext,office:o.office_alt?o.office_alt:o.office,address:o.address,website:o.website,content:o.content.rendered})))})}function a(){var t=x.find(".wsu-person").map(function(){return e(this).data("profile-id")}).get();u.val(t.join(" "))}function r(o,s){e.post(t.wsuwp_people_edit_page.ajax_url,o).done(function(){s.removeClass("active"),x.sortable("option","disabled",!1),e("body").removeClass("person-modal-open")})}var p=e("#page_template"),d=e("#wsuwp-people-directory-configuration"),c=e("#postdivrich"),h=e("#wsu-people-import"),u=e("#directory-page-profile-ids"),f=e("#wsu-people-directory-layout"),m=e("#wsu-people-directory-show-photos"),w=e("#wsu-people-directory-about"),g=e("#wsu-people-directory-link"),v=e("#wsuwp_university_orgchecklist .selectit").map(function(){return e(this).text()}).get(),b=e(".toggle-select-mode"),k=e(".select-all-people"),C=e(".delete-selected-people"),y=e(".wsu-people-wrapper"),x=e(".wsu-people"),A=e(".person-modal"),S=e(".wsu-person-controls-tooltip"),j=_.template(e("#wsu-person-template").html());e(o).ready(function(){s(),p.on("change",function(){"templates/people.php"===e(this).val()?(d.show(),c.hide()):(d.hide(),"template-builder.php"!==e(this).val()&&c.show())}),h.autocomplete({source:v,select:function(e,t){n(t)}}),f.on("change",function(){var t=e(this).val();f.find("option").not(":selected").each(function(){y.removeClass(e(this).val())}),y.addClass(t)}),m.on("change",function(){"yes"===e(this).val()?y.addClass("photos"):y.removeClass("photos")}),w.on("change",function(){var t=e(this).val();x.find(".wsu-person").each(function(){var o=e(this).find("div[data-key='"+t+"']"),s=e(this).find(".about");"none"!==t&&o.length?s.html(o.find(".content").html()):s.html("")})}),g.on("change",function(){var t=e(this).val();x.find(".wsu-person").each(function(){var o=e(this).find("div[data-key='personal']");"no"===t||"if_bio"===t&&!o.length?e(this).addClass("no-link").removeClass("link"):e(this).removeClass("no-link").addClass("link")})}),x.sortable({cursor:"move",start:function(e,t){t.placeholder.height(t.item.height())},stop:function(){a()}}),b.on("click",function(){"Bulk Select"===e(this).text()?(e(this).text("Cancel Selection"),k.show(),C.show().prop("disabled",!0),y.addClass("bulk-select"),x.sortable("option","disabled",!0)):(e(this).text("Bulk Select"),k.hide(),C.hide().prop("disabled",!0),y.removeClass("bulk-select"),x.find(".wsu-person").removeClass("selected").attr("aria-checked","false"),x.sortable("option","disabled",!1))}),k.on("click",function(){"Select All"===e(this).text()?(e(this).text("Deselect All"),x.find(".wsu-person").addClass("selected").attr("aria-checked","true"),C.prop("disabled",!1)):(e(this).text("Select All"),x.find(".wsu-person").removeClass("selected").attr("aria-checked","false"),C.prop("disabled",!0))}),x.on("click",".wsu-person",function(){y.is(".bulk-select")&&(e(this).toggleClass("selected"),e(this).hasClass("selected")?e(this).attr("aria-checked","true"):e(this).attr("aria-checked","false"),0<x.find(".selected").length?C.prop("disabled",!1):(k.text("Select All"),C.prop("disabled",!0)),x.find(".wsu-person").length===x.find(".selected").length&&k.text("Deselect All"))}),C.on("click",function(){x.find(".selected").remove(),a()}),x.on("mouseover",".wsu-person-controls button",function(){var e=this.getAttribute("aria-label"),t=this.getBoundingClientRect(),o=x[0].getBoundingClientRect();S.find(".wsu-person-controls-tooltip-inner").html(e),S.css({top:t.bottom-o.top+"px",left:t.right-o.left-S.width()/2-t.width/2+"px"}).show()}),x.on("mouseleave",".wsu-person-controls button",function(){S.hide()}),x.on("click",".wsu-person-edit",function(){e(this).closest(".wsu-person").find(".person-modal-wrapper").addClass("active"),e("body").addClass("person-modal-open"),x.sortable("option","disabled",!0)}),x.on("click",".wsu-person-remove",function(){e(this).closest(".wsu-person").remove(),a()}),x.on("click",".close",function(t){t.target===this&&(e(this).closest(".person-modal-wrapper").removeClass("active"),e("body").removeClass("person-modal-open"),x.sortable("option","disabled",!1))}),A.on("click",".choose > div",function(){e(this).toggleClass("selected"),e(this).closest(".choose").hasClass("multiple")||e(this).siblings().removeClass("selected")}),A.on("click",".person-update",function(){var o=e(this).closest(".wsu-person"),s=e(this).closest(".person-modal-wrapper"),n={action:"person_details",nonce:t.wsuwp_people_edit_page.nonce,page:t.wsuwp_people_edit_page.page_id,post:o.data("post-id")};if(s.find(".person-photos .selected")){var i=s.find(".person-photos .selected");n.photo=i.data("index"),o.find(".photo img").attr("src",i.find("img").attr("src"))}if(s.find(".person-titles .selected")){var l="",a=[],p=s.find(".person-titles .selected .content"),d=p.length;p.each(function(t){a.push(e(this).closest(".selected").data("index")),l+=e(this).html(),t!==d-1&&(l+="<br />")}),n.title=a.join(" "),o.find(".card .title").html(l)}if(s.find(".person-content .selected")){var c=s.find(".person-content .selected");n.about=c.data("key"),o.find(".about").html(c.find(".content").html())}r(n,s)})})}(jQuery,window,document);