!function(a,b,c){function d(){a(".has-photo .photo img").each(function(){a(this).attr("src",a(this).data("photo"))})}function e(c){x.html("<span class='spinner'></span>"),a.ajax({url:b.wsuwp_people_edit_page.rest_url,data:{"filter[wsuwp_university_org]":c.item.value,per_page:100}}).done(function(b){x.find(".spinner").remove(),0!==b.length&&(b.sort(f),g(b),d(),a(".wsu-people-directory-extra-options").slideDown())})}function f(a,b){return a.last_name<b.last_name?-1:a.last_name>b.last_name?1:0}function g(b){a.each(b,function(b,c){var d=x.find(".wsu-person").map(function(){return a(this).data("profile-id")}).get();-1===a.inArray(c.id,d)&&(n.val(function(){return this.value+" "+c.id}),x.append(A({nid:c.nid,id:c.id,has_photo:0<c.photos.length?" has-photo":"",slug:c.slug,name:c.title.rendered,photo:0<c.photos.length?c.photos[0].thumbnail:"",title:0<c.working_titles.length?c.working_titles[0]:c.position_title,email:c.email_alt?c.email_alt:c.email,phone:c.phone_alt?c.phone_alt:c.phone+c.phone_ext,office:c.office_alt?c.office_alt:c.office,address:c.address,website:c.website,content:c.content.rendered})))})}function h(){var b=x.find(".wsu-person").map(function(){return a(this).data("profile-id")}).get();n.val(b.join(" "))}function i(c,d){a.post(b.wsuwp_people_edit_page.ajax_url,c).done(function(){d.removeClass("active"),x.sortable("option","disabled",!1),a("body").removeClass("person-modal-open")})}var j=a("#page_template"),k=a("#wsuwp-people-directory-configuration"),l=a("#postdivrich"),m=a("#wsu-people-import"),n=a("#directory-page-profile-ids"),o=a("#wsu-people-directory-layout"),p=a("#wsu-people-directory-show-photos"),q=a("#wsu-people-directory-about"),r=a("#wsu-people-directory-link"),s=a("#wsuwp_university_orgchecklist .selectit").map(function(){return a(this).text()}).get(),t=a(".toggle-select-mode"),u=a(".select-all-people"),v=a(".delete-selected-people"),w=a(".wsu-people-wrapper"),x=a(".wsu-people"),y=a(".person-modal"),z=a(".wsu-person-controls-tooltip"),A=_.template(a("#wsu-person-template").html());a(c).ready(function(){d(),j.on("change",function(){"templates/people.php"===a(this).val()?(k.show(),l.hide()):(k.hide(),"template-builder.php"!==a(this).val()&&l.show())}),m.autocomplete({source:s,select:function(a,b){e(b)}}),o.on("change",function(){var b=a(this).val();o.find("option").not(":selected").each(function(){w.removeClass(a(this).val())}),w.addClass(b)}),p.on("change",function(){"yes"===a(this).val()?w.addClass("photos"):w.removeClass("photos")}),q.on("change",function(){var b=a(this).val();x.find(".wsu-person").each(function(){var c=a(this).find("div[data-key='"+b+"']"),d=a(this).find(".about");"none"!==b&&c.length?d.html(c.find(".content").html()):d.html("")})}),r.on("change",function(){var b=a(this).val();x.find(".wsu-person").each(function(){var c=a(this).find("div[data-key='personal']");"no"===b||"if_bio"===b&&!c.length?a(this).addClass("no-link").removeClass("link"):a(this).removeClass("no-link").addClass("link")})}),x.sortable({cursor:"move",start:function(a,b){b.placeholder.height(b.item.height())},stop:function(){h()}}),t.on("click",function(){"Bulk Select"===a(this).text()?(a(this).text("Cancel Selection"),u.show(),v.show().prop("disabled",!0),w.addClass("bulk-select"),x.sortable("option","disabled",!0)):(a(this).text("Bulk Select"),u.hide(),v.hide().prop("disabled",!0),w.removeClass("bulk-select"),x.find(".wsu-person").removeClass("selected").attr("aria-checked","false"),x.sortable("option","disabled",!1))}),u.on("click",function(){"Select All"===a(this).text()?(a(this).text("Deselect All"),x.find(".wsu-person").addClass("selected").attr("aria-checked","true"),v.prop("disabled",!1)):(a(this).text("Select All"),x.find(".wsu-person").removeClass("selected").attr("aria-checked","false"),v.prop("disabled",!0))}),x.on("click",".wsu-person",function(){w.is(".bulk-select")&&(a(this).toggleClass("selected"),a(this).hasClass("selected")?a(this).attr("aria-checked","true"):a(this).attr("aria-checked","false"),0<x.find(".selected").length?v.prop("disabled",!1):(u.text("Select All"),v.prop("disabled",!0)),x.find(".wsu-person").length===x.find(".selected").length&&u.text("Deselect All"))}),v.on("click",function(){x.find(".selected").remove(),h()}),x.on("mouseover",".wsu-person-controls button",function(){var a=this.getAttribute("aria-label"),b=this.getBoundingClientRect(),c=x[0].getBoundingClientRect();z.find(".wsu-person-controls-tooltip-inner").html(a),z.css({top:b.bottom-c.top+"px",left:b.right-c.left-z.width()/2-b.width/2+"px"}).show()}),x.on("mouseleave",".wsu-person-controls button",function(){z.hide()}),x.on("click",".wsu-person-edit",function(){a(this).closest(".wsu-person").find(".person-modal-wrapper").addClass("active"),a("body").addClass("person-modal-open"),x.sortable("option","disabled",!0)}),x.on("click",".wsu-person-remove",function(){a(this).closest(".wsu-person").remove(),h()}),x.on("click",".close",function(b){b.target===this&&(a(this).closest(".person-modal-wrapper").removeClass("active"),a("body").removeClass("person-modal-open"),x.sortable("option","disabled",!1))}),y.on("click",".choose > div",function(){a(this).toggleClass("selected"),a(this).closest(".choose").hasClass("multiple")||a(this).siblings().removeClass("selected")}),y.on("click",".person-update",function(){var c=a(this).closest(".wsu-person"),d=a(this).closest(".person-modal-wrapper"),e={action:"person_details",nonce:b.wsuwp_people_edit_page.nonce,page:b.wsuwp_people_edit_page.page_id,post:c.data("post-id")};if(d.find(".person-photos .selected")){var f=d.find(".person-photos .selected");e.photo=f.data("index"),c.find(".photo img").attr("src",f.find("img").attr("src"))}if(d.find(".person-titles .selected")){var g="",h=[],j=d.find(".person-titles .selected .content"),k=j.length;j.each(function(b){h.push(a(this).closest(".selected").data("index")),g+=a(this).html(),b!==k-1&&(g+="<br />")}),e.title=h.join(" "),c.find(".card .title").html(g)}if(d.find(".person-content .selected")){var l=d.find(".person-content .selected");e.about=l.data("key"),c.find(".about").html(l.find(".content").html())}i(e,d)})})}(jQuery,window,document);